var fn_addin=function(r,d,t){var o=o||{};return o.styles=o.styles||{},o.commands=o.commands||{},o.dependencies=t||o.dependencies||{},o.styles.style=function(){},o.views=o.views||{},o.collect=o.collect||{},o.models=o.models||{},o.templates=o.templates||{},o.info={widget:!0,id:"notes",label:"Notes",placeholderType:"pane",region:"bottom-right",order:"prepend",storedHeight:"notes-pane-height",openState:"showNotes",width:550,height:520,addin:"23c67761-9831-415e-b358-c6844eb6c244",requiredFeature:"notes",toggleEvent:"globalEvent:key:N",hideEvents:["globalEvent:toggle:bottom-left","globalEvent:toggle:bottom-right","globalEvent:toggle:top-right"],closeOnEsc:!0,visibleSetting:"notesVisible"},r.console.log(r.elapsed()+": "+o.info.id+" started"),o.templates=o.templates||{},o.templates.detail=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,s){var n;return'<div class="list-bar-wrapper">\n\t<div class="list-bar-toggle has-icon">\n\t\t<span class="control icon-wrapper toggle-list-icons" title="Note List">\n\t\t\t<i class="icon icon-list-toggle u--no-transition">\n\t\t\t\t<svg class="list-toggle-top" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 459.31 80.38"><path d="M459.31,229.65a40.2,40.2,0,0,1-40.2,40.2H40.18a40.19,40.19,0,0,1,0-80.38H419.14A40.17,40.17,0,0,1,459.31,229.65Z" transform="translate(0 -189.47)"/></svg>\n\t\t\t\t<svg class="list-toggle-middle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 459.31 80.38"><path d="M459.31,229.65a40.2,40.2,0,0,1-40.2,40.2H40.18a40.19,40.19,0,0,1,0-80.38H419.14A40.17,40.17,0,0,1,459.31,229.65Z" transform="translate(0 -189.47)"/></svg>\n\t\t\t\t<svg class="list-toggle-bottom" xmlns="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 459.31 80.38"><path d="M459.31,229.65a40.2,40.2,0,0,1-40.2,40.2H40.18a40.19,40.19,0,0,1,0-80.38H419.14A40.17,40.17,0,0,1,459.31,229.65Z" transform="translate(0 -189.47)"/></svg>\n\t\t\t</i>\n\t\t</span>\n\t</div>\n\t<div class="list-bar"></div>\n</div>\n\n<div class="detail-bar">\n\t<div class="header notes-detail-header">\n\t\t<span class="control icon-wrapper back" title="Back"><i class="icon icon-left"></i></span>\n\n\n\t\t<span class="notes-detail-title"></span>\n\n\t\t<div class="controls main-nav">\x3c!--\n\t\t--\x3e<span class="control toggle-fullscreen" title="Toggle Fullscreen">\n\t\t\t\t<span class="icon-wrapper ">\n\t\t\t\t\t<i class="icon icon-expand">\n\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M212.686 315.314L120 408l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C10.697 480 0 469.255 0 456V344c0-21.382 25.803-32.09 40.922-16.971L72 360l92.686-92.686c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.249 6.248 6.249 16.378 0 22.627zm22.628-118.628L328 104l-32.922-31.029C279.958 57.851 290.666 32 312.048 32h112C437.303 32 448 42.745 448 56v112c0 21.382-25.803 32.09-40.922 16.971L376 152l-92.686 92.686c-6.248 6.248-16.379 6.248-22.627 0l-25.373-25.373c-6.249-6.248-6.249-16.378 0-22.627z"/></svg>\n\t\t\t\t\t</i>\n\t\t\t\t\t<i class="icon icon-restore">\n\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 451.37"><path d="M443.31,81.31,350.63,174l32.92,31c15.12,15.12,4.41,41-17,41h-112a24,24,0,0,1-24-24V110c0-21.38,25.8-32.09,40.92-17l31.08,33,92.68-92.69a16,16,0,0,1,22.63,0l25.37,25.38A16,16,0,0,1,443.31,81.31Z" transform="translate(0 -28.63)"/><path d="M4.69,427.31l92.68-92.68-32.92-31c-15.12-15.12-4.41-41,17-41h112a24,24,0,0,1,24,24v112c0,21.38-25.8,32.09-40.92,17l-31.08-33L52.69,475.31a16,16,0,0,1-22.63,0L4.69,449.94a16,16,0,0,1,0-22.63Z" transform="translate(0 -28.63)"/></svg>\n\t\t\t\t\t</i>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span class="control new" title="New Note">\n\t\t\t\t<span class="icon-wrapper">\n\t\t\t\t\t<i class="icon icon-plus"></i>\n\t\t\t\t</span>\n\t\t\t</span>\x3c!--\n\t\t\t--\x3e<span class="control delete" title="Delete">\n\t\t\t\t<span class="icon-wrapper">\n\t\t\t\t\t<i class="icon icon-trash"></i>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t</div>\n\n\t\t<span class="controls delete-nav delete-group">\n\t\t\t<span class="delete delete-msg">Delete?</span>\x3c!--\n\t\t\t--\x3e<span class="delete delete-loading">Deleting...</span>\x3c!--\n\t\t\t--\x3e<span class="delete delete-failed" title="Retry">Trouble connecting...</span>\x3c!--\n\t\t\t--\x3e<span class="control delete delete-yes">\n\t\t\t\t\t<span class="icon-wrapper">\n\t\t\t\t\t\t<i class="icon icon-checkmark">\n\t\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 577.95 469.42"><polygon points="195.09 469.42 137.44 424.64 140.4 421.42 0 298 46.22 245.43 187.68 369.79 526.33 0 577.95 47.28 229.72 427.53 195.09 469.42"/></svg>\n\t\t\t\t\t\t</i>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\x3c!--\n\t\t\t--\x3e<span class="control delete delete-no">\n\t\t\t\t\t<span class="icon-wrapper">\n\t\t\t\t\t\t<i class="icon icon-x">\n\t\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 47.97 47.97"><path d="M28.23,24,47.09,5.12A3,3,0,0,0,42.85.88L24,19.74,5.12.88A3,3,0,0,0,.88,5.12L19.74,24,.88,42.85a3,3,0,1,0,4.24,4.24L24,28.23,42.85,47.09a3,3,0,0,0,4.24-4.24Z" transform="translate(0 0)"/></svg>\n\t\t\t\t\t\t</i>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t</span>\n\t</div>\n\n\t<div class="note-body"><textarea contenteditable="true" class="notes-input notes-textarea" placeholder="New Note…">'+this.escapeExpression("function"==typeof(n=null!=(n=e.body||(null!=t?t.body:t))?n:e.helperMissing)?n.call(t,{name:"body",hash:{},data:s}):n)+"</textarea></div>\n</div>\n"},useData:!0}),o.templates.item=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,s){var n,o=e.helperMissing,l="function",a=this.escapeExpression;return'<div class="notes-list-title-group">\n\t<span class="notes-list-title">'+a(typeof(n=null!=(n=e.title||(null!=t?t.title:t))?n:o)===l?n.call(t,{name:"title",hash:{},data:s}):n)+'</span>\x3c!--\n\t--\x3e<span class="notes-list-date">'+a(typeof(n=null!=(n=e.updatedDate||(null!=t?t.updatedDate:t))?n:o)===l?n.call(t,{name:"updatedDate",hash:{},data:s}):n)+'</span>\n</div>\n<span class="notes-list-body">'+a(typeof(n=null!=(n=e.body||(null!=t?t.body:t))?n:o)===l?n.call(t,{name:"body",hash:{},data:s}):n)+"</span>\n"},useData:!0}),o.templates.list=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,s){return'<div class="notes-list">\n\t<div class="note-list-outer-wrapper">\n\t\t<div class="note-list-wrapper">\n\t\t\t<ol class="list note-list"></ol>\n\t\t</div>\n\t</div>\n\t<footer class="footer-input">\n\t\t<input class="notes-input notes-new" type="text" placeholder="New Note">\n\t\t<i class="loading-icon notes-new-loading"></i>\n\t\t<i class="error-icon notes-new-error" title="Trouble connecting... Click to retry">!</i>\n\t</footer>\n\t<div class="u--pafill notes-empty">\n\t\t<div class="empty">\n\t\t\t<div class="title">Take quick notes and store wisdom to view later.</div>\n\t\t\t<div class="description">No notes yet. Add a note to get started!</div>\n\t\t\t<span class="button notes-empty-new">New Note</span>\n\t\t</div>\n\t</div>\n\t<div class="notes-loading"><i class="loading-icon"></i>Loading…</div>\n</div>\n'},useData:!0}),o.templates.notes=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,s){return'<div class="subviews-wrapper">\n\t<div class="subviews u--no-transition">\x3c!--\n\t\t--\x3e<div class="subview list-view"></div>\x3c!--\n\t\t--\x3e<div class="subview detail-view"></div>\n\t</div>\n</div>\n'},useData:!0}),o.styles=o.styles||{},o.styles.style=function(){var t=document.createElement("style");t.type="text/css",t.innerHTML='.list-borders:after,.list-borders:first-child:before{height:1px;position:absolute;bottom:0;left:var(--app-padding);right:var(--app-padding);background:rgba(255,255,255,.15);content:""}.list-borders:first-child:before{top:0;bottom:auto}.notes{--width:550px}.notes .app{height:520px;width:var(--width);min-width:450px;padding:0;max-width:none;overflow:hidden;transition:transform var(--a-fast) var(--a-curve)}.notes .subviews-wrapper{transition:opacity .1s ease}.notes.hide-content .subviews-wrapper{opacity:0}.notes-list{height:100%;display:flex;flex-direction:column;box-sizing:border-box}.notes-list.loading{align-items:center;justify-content:center}.note-list-header,.notes-list.loading .footer-input,.notes-list.loading .note-list-outer-wrapper,.notes-list.loading .notes-empty{display:none}.notes-loading{display:none;opacity:.7}.notes-list.loading .notes-loading{display:block}.note-list-outer-wrapper{min-height:0;display:flex;flex:1}.note-list-wrapper{padding-top:var(--app-padding);flex:1;overflow-y:auto}.note-list{display:flex;flex-direction:column}.notes-list-item{padding:8px var(--app-padding);position:relative;cursor:pointer;font-size:100%;-webkit-transition:color .05s ease}.notes-list-body,.notes-list-title{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.notes-list-title-group{display:flex;align-items:baseline}.notes-list-title{max-width:84%;font-weight:500;opacity:.8}.notes-list-item.selected .notes-list-title,.notes-list-item:hover .notes-list-title{opacity:1}.notes-list-date{padding-left:11px;flex-shrink:0;font-size:87.5%;opacity:.4}.notes-list-item.selected .notes-list-date,.notes-list-item:hover .notes-list-date{opacity:.6}.notes-list-body{margin-top:3px;display:block;font-size:86.667%;opacity:.5}.notes-list-item.selected .notes-list-body,.notes-list-item:hover .notes-list-body{opacity:.8}.notes-list-item.selected{box-shadow:inset 4px 0 0 0 rgba(255,255,255,.6);z-index:10}.light .notes-list-item.selected{box-shadow:inset 4px 0 0 0 rgba(0,0,0,.4);z-index:10}.notes .footer-input{flex:0 0 auto}.notes .notes-input{width:100%;background:0 0;border:0;box-sizing:border-box;font-size:100%;outline-width:0}.notes .notes-new{padding-top:11px}.notes-empty-loading{display:none}.loading .notes-empty-loading{display:block}.notes-empty-new{cursor:pointer}.notes-empty-description{margin:0;font-size:93.75%;opacity:.575}.notes .loading .description,.notes .loading .title{display:none}.notes .empty{height:100%;display:flex}.notes-new-loading{height:11px;width:11px;position:absolute;top:13px;right:10px;display:none;border-width:1px}.loading .notes-new-loading{display:inline}.notes-new-error{height:14px;width:14px;position:absolute;top:12px;right:16px;display:none;border-radius:100%;text-align:center;-webkit-user-select:auto;user-select:auto}.failed .notes-new-error{display:inline}.notes-detail{--notes-detail-header-height:47px;height:100%;display:flex;align-items:stretch}.notes-detail-header{height:var(--notes-detail-header-height);padding:0!important;position:relative;z-index:2;align-items:center;justify-content:center}.notes-detail-title{display:inline-block;opacity:.45;font-size:87.5%}.notes-detail .header .back{position:absolute;left:0}.notes.fullscreen .notes-detail .header .back{display:none}.notes-detail .header .controls{position:absolute;right:calc(var(--app-padding) - 6px)}.notes-detail .control{padding-top:0;padding-bottom:0;cursor:pointer}.notes-detail .controls .icon-wrapper{padding:6px}.notes-detail .icon{height:19px;width:16px;text-align:center;font-family:Arial,Helvetica,sans-serif}.notes-detail .icon-left{height:14px;margin-bottom:1px}.notes-detail .new .icon-wrapper{margin-right:-2px;margin-left:-1px}.notes-detail .icon-plus{height:20px;width:19px;margin-bottom:1px}.notes-detail .icon-expand svg,.notes-detail .icon-restore svg{width:13px;margin-top:2px}.notes-detail .icon-trash{height:15px;margin-bottom:2px;font-size:14px}.notes .delete-group{display:none;align-items:center;opacity:.96;font-size:87.5%}.notes-detail .delete-group.show{display:flex}.notes .delete-group .delete-msg{height:auto;margin-right:10px}.notes .delete-group .control.delete{width:25px;margin:0 1px;opacity:1}.notes .delete-group .icon{height:auto}.notes .delete-group .icon-checkmark{width:13px}.notes .delete-group .icon-x{width:11px}.notes-detail .delete-failed,.notes-detail .delete-group.loading .delete,.notes-detail .delete-loading{display:none}.notes-detail .delete-group.loading .delete-loading{display:inline}.notes-detail .delete-group.failed .delete{display:none}.notes-detail .delete-group.failed .delete-failed{display:inline}.notes .delete-group .delete-loading{margin-right:6px}.notes .delete-group .delete-failed{padding:6px;opacity:.8;cursor:pointer}.notes .delete-group .delete-failed:hover{opacity:1}.note-body{flex-grow:1;display:flex}.notes .notes-textarea{height:auto;padding:var(--app-padding);padding-top:6px;flex-grow:1;opacity:.96;border-bottom:none;cursor:text;line-height:140%}.notes .subviews{width:2200px;position:absolute}.detail-view,.list-view{transition:all .2s ease}.notes .list-bar-wrapper{display:none}.notes .detail-view,.notes .list-view{width:550px;height:520px}.notes .list-bar{display:flex;flex-direction:column}.notes .note-list-header .toggle-list-icons{transition:transform .5s ease}.notes .detail-bar{flex:1 0;display:inline-flex;position:relative;flex-direction:column}.notes .notes-detail-header .toggle-list-icons{padding-left:12px}.notes .icon-restore{display:none}.notes.fullscreen .subviews{height:100%;width:100%;transform:translateY(0)}.notes.fullscreen .list-bar-wrapper{max-width:0;position:relative;z-index:3;flex:1 1 20%;display:flex;flex-direction:column;border-right:1px solid rgba(255,255,255,0);box-sizing:content-box;transition:all .5s ease}.notes.fullscreen .list-bar-open .list-bar-wrapper{max-width:var(--list-bar-width);border-right:1px solid rgba(255,255,255,.15);transform:translateX(0)}.light .notes.fullscreen .list-bar-open .list-bar-wrapper{border-color:rgba(0,0,0,.1)}.notes.fullscreen .list-bar{width:var(--list-bar-width);position:absolute;top:var(--notes-detail-header-height);right:-50px;bottom:0;transition:opacity .5s ease,right .5s ease;opacity:0;visibility:hidden}.notes.fullscreen .list-bar-open .list-bar{right:0;opacity:1}.notes.fullscreen .show-list .list-bar{visibility:visible}.notes.fullscreen .notes-list-date{font-size:83.33333%}.notes.fullscreen .list-bar-toggle{height:var(--notes-detail-header-height);position:absolute;top:0;right:-50px;bottom:calc(100% - var(--notes-detail-header-height));left:0;display:flex;justify-content:flex-end;align-items:stretch;cursor:pointer;transition:right .5s ease,border .5s ease}.notes.fullscreen .list-bar-open .list-bar-toggle{right:0}.notes.fullscreen .list-bar-toggle .icon-wrapper{padding-left:19px;padding-right:19px}.notes.list-bar-toggle .icon-x{width:13px;display:none}.notes.list-bar-open .list-bar-toggle .icon-x{display:inline-block}.notes.fullscreen .notes-new,.notes.list-bar-open .list-bar-toggle .icon-list{display:none}.notes.fullscreen .note-list-wrapper{padding-top:0}.notes.fullscreen .notes-list{font-size:112.5%}.notes.fullscreen .note-list{padding-bottom:var(--app-padding)}.notes.fullscreen .notes-list-title{max-width:71%}.notes.fullscreen .notes-list-item{padding-left:var(--app-padding);padding-right:var(--app-padding)}.notes.fullscreen .notes-list-item.selected{background-color:rgba(255,255,255,.1);box-shadow:none;z-index:0}.fullscreen .list-borders.above-selected:after,.fullscreen .list-borders.selected:first-child:before,.notes.fullscreen .list-borders.selected:after{left:0;right:0}.notes.fullscreen .list-borders.above-selected:after{bottom:-1px}.light .notes.fullscreen .notes-list-item.selected{background-color:rgba(0,0,0,.04)}.notes.fullscreen .detail-view{--list-bar-width:280px;height:100%;width:100%;position:absolute;top:0;right:0;bottom:0;left:0}.notes.fullscreen .notes-detail-header{width:100%;padding:0!important;position:absolute;justify-content:space-between}.notes.fullscreen .notes-detail-header .toggle-list-icons{display:flex}.notes.fullscreen .list-bar-open .notes-detail-header .toggle-list-icons,.notes.fullscreen .notes-detail-title{display:none}.toggle-list-icons .icon-list-toggle{height:7px;width:13px;position:relative}.icon-list-toggle .list-toggle-bottom,.icon-list-toggle .list-toggle-middle,.icon-list-toggle .list-toggle-top{height:13px;width:13px;position:absolute;left:0;transition:transform .5s ease,opacity .5s ease}.icon-list-toggle .list-toggle-top{top:-8px}.icon-list-toggle .list-toggle-middle{top:-3px}.icon-list-toggle .list-toggle-bottom{bottom:-8px}.list-bar-open .icon-list-toggle .list-toggle-top{transform:rotate(-45deg) translate(-3.5px,3.5px)}.list-bar-open .icon-list-toggle .list-toggle-middle{opacity:0}.list-bar-open .icon-list-toggle .list-toggle-bottom{transform:rotate(45deg) translate(-3.5px,-3.5px)}.notes.fullscreen .icon-restore{display:inline-block}.notes.fullscreen .icon-expand{display:none}.notes.fullscreen .note-body{position:absolute;top:var(--notes-detail-header-height);right:0;bottom:0;left:0}.notes .fullscreen-textarea .notes-textarea{padding:50px calc((100% - 750px)/ 2);font-size:19px;line-height:160%}@media handheld and (max-width:1130px),screen and (max-device-width:1130px),screen and (max-width:1130px){.notes .fullscreen-textarea .notes-textarea{transition:padding .5s ease}.notes.hide-content .fullscreen-textarea .notes-textarea{transition:none}.notes .fullscreen-textarea .list-bar-open .notes-textarea{padding:50px calc((var(--list-bar-width) - (100vw - 100%))/ 2 + 50px)}}@media handheld and (max-width:850px),screen and (max-device-width:850px),screen and (max-width:850px){.notes .fullscreen-textarea .notes-textarea{padding:50px}}',document.getElementsByTagName("head")[0].appendChild(t)},o.collect.Notes=Backbone.Collection.extend({localStorage:new Backbone.LocalStorage("notes"),baseUrl:r.globals.urlRootApi+"notes",notes_version:"1.0.3",initialize:function(){this.model=o.models.Note,this.listenTo(this,"change",this.onChange),this.listenTo(this,"reset",this.onReset),this.listenTo(this,"add",this.onAdd),window.addEventListener("storage",this.handleStorageEvent.bind(this),!1),this.fetchedFromServer=!1},handleStorageEvent:function(t){this.removing_items||"notes"!=t.key.slice(0,5)||this.fetch()},activeNotes:function(){return _(this.where({deleted:!1})).chain().sortBy(function(t){return-t.get("updatedDate")}).value()},next:function(t){var e=this.activeNotes(),i=e.indexOf(t);return e[i==e.length-1?0:i+1]},prev:function(t){var e=this.activeNotes(),i=e.indexOf(t);return e[0==i?e.length-1:i-1]},onReset:function(){this.models.map(function(t){t.isDummy()&&t.delete()});var t=this,e=0<this.models.length;e&&this.hasAttribute("changed_props")?this.syncToServer(function(){t.fetchFromServer(function(){e||0<t.models.length&&t.trigger("active-model-changed")})}):t.fetchFromServer(function(){e||(0<t.models.length?t.trigger("active-model-changed"):t.trigger("update"))})},findHavingAttribute:function(e){return this.filter(function(t){return t.has(e)})},findNotHavingAttribute:function(e){return this.filter(function(t){return!t.has(e)})},findNewModels:function(){return this.filter(function(t){return!t.isDummy()})},hasAttribute:function(e){return!!this.find(function(t){return t.has(e)})},onAdd:function(t,e,i){i&&i.ignoreSave||this.syncToServer()},onChange:function(t,e){var i=this;if(!e.ignoreSave){var s=t.changedAttributes();if(s){var n=null;for(prop in s)s.hasOwnProperty(prop)&&"changed_props"!=prop&&"_id"!=prop&&(n||(n=t.get("changed_props")||[]),_.contains(n,prop)||(n.push(prop),!0));n&&(t.save({updatedDate:new Date},{silent:!0,ignoreSave:!0}),n.push("updatedDate"),t.save({changed_props:n,updatedDate:Date.now()},{silent:!1,ignoreSave:!0,success:function(){setTimeout(function(){i.syncToServer()},50)}}))}}},syncToServer:function(t){var a=this,e=this.findHavingAttribute("changed_props");e&&0!=e.length||(e=this.findNewModels())&&0!=e.length?nimble.each(e,function(e,t){var i=!e.has("_id");if(!i){var s=e.get("changed_props");if(!s||0==s.length)return void t()}var n={};if(i){var o=e.toJSON();o._cid=o.id,delete o.changed_props,delete o.id,o.notes_version=a.notes_version,d.ajax({url:a.baseUrl,contentType:"application/json",type:"POST",beforeSend:r.utils.setMomentumAuthHeader,data:JSON.stringify(o)}).done(function(t){t&&t._id&&e.save({changed_props:null,_id:t._id},{silent:!0,ignoreSave:!0})}).fail(function(t,e){}).always(function(){t()})}else{if(_.each(s,function(t){"changed_props"!=t&&(n[t]=e.get(t))}),1==Object.keys(n).length&&n.hasOwnProperty("updatedDate")||2==Object.keys(n).length&&n.hasOwnProperty("updatedDate")&&n.hasOwnProperty("id"))return e.save({changed_props:null},{silent:!0,ignoreSave:!0}),void t();var l=a.baseUrl+"/"+encodeURIComponent(e.get("_id"));n.notes_version=a.notes_version,d.ajax({url:l,contentType:"application/json",type:"PATCH",beforeSend:r.utils.setMomentumAuthHeader,data:JSON.stringify(n)}).done(function(t){e.save({changed_props:null},{silent:!0,ignoreSave:!0})}).fail(function(t,e){}).always(function(){t()})}},function(){t&&t()}):t&&t()},fetchFromServer:function(t){var s=this;d.ajax({url:this.baseUrl,contentType:"application/json",type:"GET",beforeSend:r.utils.setMomentumAuthHeader}).done(function(t){if(t){var i=[];_.each(t,function(t){var e=s.findWhere({id:t.id});e||(e=s.findWhere({_id:t._id})),e?(i.push(e.id),e.save(t,{silent:!0,ignoreSave:!0})):(i.push(t.id),s.create(t,{ignoreSave:!0}))});var e=[];s.each(function(t){t.has("id")&&!_.contains(i,t.get("id"))&&e.push(t.get("id"))}),0<e.length&&(s.removing_items=!0,_.each(e,function(t){var e=s.get(t);e&&e.destroy()}),s.removing_items=!1)}}).fail(function(t,e){}).always(function(){s.fetchedFromServer=!0,s.trigger("fetchedFromServer"),t&&t()})}}),o.models.Note=Backbone.Model.extend({defaults:function(){return{body:"",createdDate:new Date,updatedDate:Date.now(),deleted:!1}},constants:{titleLengthGuide:60,bodyPreviewMaxLength:150},delete:function(t){t=t||{},this.isDummy()?this.destroy(t):this.save({deleted:!0},t)},isDummy:function(){return 0===this.get("body").length&&!this.get("_id")},generateTitle:function(){var t,e,i,s=this.get("body");return s?(-1!=(i=(t=-1!=(e=s.indexOf("\n"))?s.slice(0,e):s).indexOf(" ",this.constants.titleLengthGuide-1))&&(t=t.slice(0,i)),t):"Empty Note"},checkForMultiLineNote:function(t){var e,i;return!!(e=-1!=(i=t.indexOf("\n"))?t.slice(i,t.length-1):null)&&-1!==e.search(/[^\s]+/)},getBodyPreview:function(){var t=this.get("body"),e=this.generateTitle();return this.delighter=this.delighter||this.getRandomDelighter(),t?this.checkForMultiLineNote(t)?t.substr(e.length,this.constants.bodyPreviewMaxLength).trim():"No additional text":this.delighter},getRandomDelighter:function(){var t=["Type something cool!","Think of the possibilities...","Record some wisdom","Use your words","Type a tidbit","This is your canvas"];return t[Math.floor(Math.random()*t.length)]}}),o.views.Detail=Backbone.View.extend({className:"notes-detail",template:o.templates.detail,autosaveInterval:5e3,usingMouse:!1,events:{"click .back":"handleClickBack","click .new":"new","click .delete":"toggleDeleteConf","click .delete-yes":"handleClickDelete","click .delete-no":"closeDeleteConf","click .delete-failed":"handleClickDelete","click .list-bar-toggle":"toggleListBar","blur .notes-textarea":"onBlur","keyup .notes-textarea":"handleKeyUp"},initialize:function(t){this.list=t.list,this.addListeners(),this.render(),this.startAutosaveInterval(),this.showDeleteConf=!1;var e=this;window.onbeforeunload=function(){e.saveToModel()}},render:function(t){return this.$el.html(this.template({body:this.model.get("body"),isFullScreen:this.list.isFullScreen})),this.$noteTitle=this.$(".notes-detail-title"),this.$actionRightGroup=this.$(".main-nav"),this.$deleteGroup=this.$(".delete-nav"),this.$deleteYes=this.$(".delete-yes"),this.$textarea=this.$el.find(".notes-textarea"),this.setModel(this.model,this.scrollToBottom),this},setModel:function(t,e){this.model!==t&&(this.stopListening(this.model),this.model=t,this.addListeners(),this.$(".notes-textarea").val(this.model.get("body")),this.showDeleteConf&&this.closeDeleteConf()),this.updateTitle();var i=this;setTimeout(function(){i.focusTextarea(),e&&i.scrollToBottom()},100)},addListeners:function(){this.listenTo(r,"globalEvent:arrowLeft globalEvent:key:backspace globalEvent:esc globalEvent:metaEnter",this.handleGlobalBack),this.listenTo(r,"globalEvent:metaBackspace",this.handleGlobalMetaBackspace),this.listenTo(r,"globalEvent:shiftN",this.handleGlobalCtrlN),this.listenTo(r,"globalEvent:metaBracketLeft",this.handleGlobalMetaBracketLeft),this.listenTo(r,"globalEvent:metaBracketRight",this.handleGlobalMetaBracketRight),this.listenTo(r,"globalEvent:altF",this.handleGlobalAltF),this.listenTo(r,"globalEvent:altL",this.handleGlobalAltL),this.listenTo(r.models.customization,"change:hour12clock",this.updateTitle),this.listenTo(this.model,"change:updatedDate",this.updateTitle),this.listenTo(this,"destroy",this.destroy)},updateTitle:function(){this.model&&this.$noteTitle.text(this.formatDate(new Date(this.model.get("updatedDate")),r.models.customization.get("hour12clock")))},destroy:function(){this.clearAutosaveInterval(),this.remove(),this.unbind(),this.$el.html("")},onBlur:function(){this.saveToModel()},saveToModel:function(){var t=this.$textarea.val();this.model&&t!==this.model.get("body")&&this.model.set({body:t})},startAutosaveInterval:function(){var t=this;this.saveNoteInterval||(this.saveNoteInterval=setInterval(function(){t.saveToModel()},this.autosaveInterval))},clearAutosaveInterval:function(){this.saveNoteInterval&&(clearInterval(this.saveNoteInterval),this.saveNoteInterval=null)},focusTextarea:function(){var e=this;setTimeout(function(){e.$textarea.focus();var t=e.$textarea[0];t.selectionStart=t.selectionEnd=t.value.length},0)},handleKeyUp:function(t){this.list.isFullScreen&&t&&13===t.keyCode&&this.$textarea.prop("selectionStart")===this.$textarea.val().length&&this.scrollToBottom()},scrollToBottom:function(){this.$textarea.scrollTop(this.$textarea[0].scrollHeight)},handleClickBack:function(t){this.usingMouse=!0,t.stopPropagation(),this.back()},handleClickDelete:function(t){this.usingMouse=!0,t.stopPropagation(),this.delete()},back:function(){this.list.isFullScreen?this.list.toggleFullscreen():(this.saveToModel(),this.list.handleBack(!1),this.model=null)},toggleListBar:function(){var t=this;this.list.isFullScreen&&(this.list.listBarOpen?(this.list.listBarOpen=!1,this.$el.removeClass("list-bar-open"),this.timeout=setTimeout(function(){t.$el.removeClass("show-list")},500)):(this.timeout&&clearTimeout(this.timeout),this.$(".list-bar").html()||(this.list.loadList(".list-bar"),this.list.addAll(!0)),this.list.listBarOpen=!0,this.$el.addClass("show-list list-bar-open")))},new:function(){this.model.get("body")?(this.model=null,this.list.createNoteDetail()):this.focusTextarea()},toggleDeleteConf:function(){this.showDeleteConf=!this.showDeleteConf,this.$deleteGroup.toggleClass("show"),this.$deleteYes.removeClass("loading failed"),this.$actionRightGroup.toggle()},closeDeleteConf:function(t){t&&t.stopPropagation(),this.showDeleteConf=!1,this.$deleteGroup.removeClass("show"),this.$deleteYes.removeClass("loading failed"),this.$actionRightGroup.show()},delete:function(){var e=this;e.$deleteGroup.removeClass("failed").addClass("loading"),e.model.delete({wait:!0,success:function(){if(e.$deleteGroup.removeClass("loading"),e.list.isFullScreen)if(e.list.collection.activeNotes().length){var t=e.list.collection.activeNotes()[0];e.setModel(t),e.list.selectItemById(t.id)}else e.list.toggleFullscreen(),e.list.handleBack(!0);else e.list.handleBack(!0)},error:function(){e.$deleteGroup.removeClass("loading").addClass("failed")}}),r.sendEvent("Notes","Delete")},deleteViaHotkey:function(){this.toggleDeleteConf(),this.delete()},handleGlobalBack:function(t){this.list.open&&(t.preventDefault(),t.stopPropagation(),this.back())},handleGlobalMetaBackspace:function(t){this.list.open&&(t.preventDefault(),t.stopPropagation(),this.deleteViaHotkey())},handleGlobalShiftN:function(t){this.list.open&&(t.preventDefault(),t.stopPropagation(),this.list.createNoteDetail())},handleGlobalAltL:function(t){this.list.open&&(t.preventDefault(),this.list.isFullScreen&&this.toggleListBar())},handleGlobalAltF:function(t){this.list.open&&(t.preventDefault(),this.list.toggleFullscreen())},handleGlobalMetaBracketLeft:function(t){this.list.open&&(t.preventDefault(),t.stopPropagation(),this.saveToModel(),this.list.detailPrevNote(this.model))},handleGlobalMetaBracketRight:function(t){this.list.open&&(t.preventDefault(),t.stopPropagation(),this.saveToModel(),this.list.detailNextNote(this.model))},formatDate:function(t,e){var i,s=t.getHours(),n=r.utils.twoDigit(t.getMinutes());e?i=(s%12||12)+":"+n+" "+(12<=s?"PM":"AM"):i=r.utils.twoDigit(s)+":"+n;return r.utils.formatMonthDayRelative(t,!1)+r.utils.formatYearRelative(t)+" at "+i}}),o.views.Item=Backbone.View.extend({attributes:{class:"list-borders notes-list-item"},tagName:"li",template:o.templates.item,events:{click:"handleClick"},initialize:function(t){this.list=t.list,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"change:archive change:deleted remove",this.remove),this.listenTo(r.models.customization,"change:hour12clock",this.render)},render:function(){this.$placeholder=d("<li></li>").addClass("placeholder"),this.$placeholder.appendTo(this.el),this.$placeholder.hide();var t={title:this.model.generateTitle(),body:this.model.getBodyPreview(),updatedDate:this.formatDate(new Date(this.model.get("updatedDate")))};return this.$el.html(this.template(t)),this.$el.attr("data-note-id",this.model.id),this},destroy:function(){this.remove(),this.unbind()},handleClick:function(){this.list.handleItemClick(this.model)},formatDate:function(t){return r.utils.dateIsToday(t)?this.formatTime(t,r.models.customization.get("hour12clock")):r.utils.dateIsInLast7d(t)?r.utils.getDayName(t,!0):r.utils.getMonthName(t,!0)+" "+t.getDate()+r.utils.formatYearRelative(t)},formatTime:function(t,e){var i,s=t.getHours(),n=r.utils.twoDigit(t.getMinutes());e?i=(s%12||12)+":"+n+" "+(12<=s?"PM":"AM"):i=r.utils.twoDigit(s)+":"+n;return i}}),o.views.List=Backbone.View.extend({attributes:{id:"notes",class:"app notes-app"},template:o.templates.notes,open:!1,selectedNote:null,events:{"click .notes-empty-new":"createNoteFromEmptyState","keyup .notes-new":"handleInputKeyup","click .notes-new-error":"handleClickError","click .toggle-fullscreen":"toggleFullscreen"},initialize:function(){this.$el.attr(_.result(this,"attributes")),this.subViews=[],this.render();var t=this;this.listenTo(r,"globalEvent:arrowUp",this.handleGlobalArrowUp),this.listenTo(r,"globalEvent:arrowDown",this.handleGlobalArrowDown),this.listenTo(r,"globalEvent:arrowRight globalEvent:key:enter",this.handleGlobalArrowRight),this.listenTo(r,"globalEvent:key:shiftN globalEvent:key:A",this.focusOnNewNote),this.listenTo(r,"globalEvent:metaBackspace",this.handleGlobalMetaBackspace),this.listenTo(this.collection,"reset",function(){t.addAll()}),this.listenTo(this.collection,"add",this.onCollectionAdd),this.listenTo(this.collection,"update",this.handleUpdate),this.listenTo(this.collection,"change:updatedDate",this.handleChangeUpdatedDate),this.listenTo(this.collection,"fetchedFromServer",this.handleUpdate),this.timeouts=[],this.collection.fetch({reset:!0}),this.isFullScreen=!1,this.listBarOpen=!1},handleChangeUpdatedDate:function(){this.addAll()},render:function(){this.$el.addClass("u--no-transition"),this.$el.html(this.template()),this.loadList(".list-view"),this.handleUpdate();var t=this;return this.renderedOnce||(setTimeout(function(){t.$el.removeClass("u--no-transition"),t.$el.find(".subviews").removeClass("u--no-transition")},20),this.renderedOnce=!0),this},loadList:function(t){this.$el.find(t).html(o.templates.list()),this.$empty=this.$(".notes-empty"),this.$noteList=this.$(".note-list"),this.$notesNewContainer=this.$(".notes-new-container"),this.$notesNew=this.$(".notes-new")},addAll:function(t){var i=this,s=void 0!==this.selectedNote&&d(this.$(".notes-list-item")[this.selectedNote]).attr("data-note-id");_.each(this.subViews,function(t){t&&t.destroy()}),this.subViews=[],_.each(this.collection.activeNotes(),function(t,e){i.addOne(t,!0),s===t.id&&(i.selectedNote=e)}),this.$(".notes-list").removeClass("loading"),this.handleUpdate();var e=localStorage.getItem("current-note-id");if(e&&!t){var n=this.collection.get(e);!n||n.get("deleted")||n.isDummy()||this.switchToDetailView(n)}},addOne:function(t,e){var i=new o.views.Item({model:t,list:this}),s=i.render().el;this.subViews.push(i),e?this.$noteList.append(s):this.$noteList.prepend(s)},onCollectionAdd:function(t){this.addOne(t,!1)},handleUpdate:function(){var t=this.collection.activeNotes().length;0==t&&this.collection.fetchedFromServer?(this.$(".notes-list").removeClass("loading"),this.$empty.mShow(),this.$notesNew.mHide(),this.$noteList.mHide()):0!=t||this.collection.fetchedFromServer?(this.$(".notes-list").removeClass("loading"),this.$empty.mHide(),this.isFullScreen||this.$notesNew.mShow(),this.$noteList.mShow(),this.selectedNote==t&&this.selectedNote--,d(this.$(".notes-list-item")[this.selectedNote]).addClass("selected").prev().addClass("above-selected")):this.$(".notes-list").addClass("loading")},handleItemClick:function(t){this.switchToDetailView(t,!1,!0)},handleClickError:function(t){t.stopPropagation(),this.createNote()},switchToDetailView:function(t,e,i){this.detailView&&this.detailView.model&&this.detailView.model.isDummy()&&this.detailView.model.delete();var s=this;if(t&&!(this.isDetailActive()&&this.detailView.slidingOut||this.modelInFocus===t.id)){if(this.modelInFocus=t.id,this.isDetailActive()?this.detailView.setModel(t):this.detailView=new o.views.Detail({model:t,list:this}),!this.isFullScreen&&!e){var n=this.$el.find(".note-list-wrapper");this.hideListScrollBar(n),this.$el.find(".detail-view").html(s.detailView.render(!i).el),this.$el.find(".subviews").addClass("second"),setTimeout(function(){s.showListScrollBar(n)},200)}this.selectItemById(t.id),localStorage.setItem("current-note-id",t.id)}},destroyDetailView:function(){this.detailView&&(this.detailView.destroy(),this.detailView=null)},hideListScrollBar:function(t){var e=t.length&&t[0].offsetWidth-t[0].clientWidth;t.css({"overflow-y":"hidden","margin-right":e||""})},showListScrollBar:function(t){t.css({"overflow-y":"","margin-right":""})},handleBack:function(t){var e=this;!t&&this.detailView.model&&this.detailView.model.isDummy()&&this.detailView.model.delete();var i=this.$el.find(".note-list-wrapper");this.hideListScrollBar(i),this.$el.find(".subviews").removeClass("second"),this.handleUpdate(),!t&&this.detailView.model&&this.selectItemById(this.detailView.model.id),this.scrollItemIntoView(this.$noteList.find(".notes-list-item.selected")),this.detailView.usingMouse&&this.clearSelectedNote(),this.focusNewNote(),this.modelInFocus=null,this.listBarOpen=!1,localStorage.removeItem("current-note-id"),this.detailView.slidingOut=!0,setTimeout(function(){e.destroyDetailView(),e.showListScrollBar(i)},200)},handleInputKeyup:function(t){13==t.keyCode?(t.stopPropagation(),this.createNote()):38==t.keyCode?(this.$notesNew.blur(),this.selectPrevItem()):40==t.keyCode&&(this.$notesNew.blur(),this.selectNextItem())},handleGlobalArrowUp:function(t){this.open&&!this.isDetailActive()&&(t.preventDefault(),t.stopPropagation(),this.selectPrevItem())},handleGlobalArrowDown:function(t){this.open&&!this.isDetailActive()&&(t.preventDefault(),t.stopPropagation(),this.selectNextItem())},handleGlobalArrowRight:function(t){this.open&&!this.isDetailActive()&&(t.preventDefault(),t.stopPropagation(),this.switchToDetailFromKeyboard())},focusOnNewNote:function(t){this.open&&!this.isDetailActive()&&(t.preventDefault(),t.stopPropagation(),this.focusNewNoteViaHotkey())},handleGlobalMetaBackspace:function(t){this.open&&!this.isDetailActive()&&(t.preventDefault(),t.stopPropagation(),this.deleteItemFromKeyboard())},selectPrevItem:function(){if(0!=this.collection.activeNotes().length){var t=this.$(".notes-list-item");null==this.selectedNote?this.selectedNote=t.length-1:(d(t[this.selectedNote]).removeClass("selected").prev().removeClass("above-selected"),this.selectedNote=0==this.selectedNote?t.length-1:this.selectedNote-1),d(t[this.selectedNote]).addClass("selected"),this.scrollItemIntoView(d(t[this.selectedNote]))}},selectNextItem:function(){if(0!=this.collection.activeNotes().length){var t=this.$(".notes-list-item");null==this.selectedNote?this.selectedNote=0:(d(t[this.selectedNote]).removeClass("selected").prev().removeClass("above-selected"),this.selectedNote=this.selectedNote==t.length-1?0:this.selectedNote+1),d(t[this.selectedNote]).addClass("selected").prev().addClass("above-selected"),this.scrollItemIntoView(d(t[this.selectedNote]))}},tearDown:function(){this.isFullScreen&&this.toggleFullscreen()},selectItemById:function(t){this.$noteList.find(".notes-list-item.selected").removeClass("selected").prev().removeClass("above-selected");var e=this.$noteList.find('[data-note-id="'+t+'"]');e.prev().addClass("above-selected"),this.selectedNote=e.addClass("selected").index()},clearSelectedNote:function(){this.$noteList.find(".notes-list-item.selected").removeClass("selected").prev().removeClass("above-selected"),this.selectedNote=null},switchToDetailFromKeyboard:function(){this.switchToDetailView(this.getSelectedNoteModel())},deleteItemFromKeyboard:function(){this.getSelectedNoteModel().delete(),0==this.collection.activeNotes().length&&(this.selectedNote=null,this.focusNewNote())},getSelectedNoteModel:function(){var t=d(this.$(".notes-list-item")[this.selectedNote]).data("note-id");return this.collection.get(t)},createNote:function(t){var e=this;if(!this.$notesNewContainer.hasClass("loading")){var i=this.$notesNew[0].value.trim();i&&(i+="\n",this.$notesNewContainer.removeClass("failed").addClass("loading"),e.collection.create({body:i},{wait:!0,success:function(t){e.$notesNewContainer.removeClass("loading"),e.switchToDetailView(t),e.$notesNew[0].value=""},error:function(){e.$notesNewContainer.removeClass("loading").addClass("failed")}}),r.sendEvent("Notes","Create from List"))}},createNoteFromEmptyState:function(){var e=this;this.model=null,e.collection.create({body:""},{wait:!0,success:function(t){e.switchToDetailView(t)},error:function(){console.log("error creating note")}})},createNoteDetail:function(){var e=this;this.model=null,e.collection.create({body:""},{wait:!0,success:function(t){e.switchToDetailView(t,!0)},error:function(){console.log("error creating note")}}),r.sendEvent("Notes","Create from Detail")},detailNextNote:function(t){this.switchToDetailView(this.collection.next(t))},detailPrevNote:function(t){this.switchToDetailView(this.collection.prev(t))},focusNewNote:function(){null==this.selectedNote&&this.$notesNew.focus()},focusNewNoteViaHotkey:function(){null!=this.selectedNote&&this.clearSelectedNote(),this.$notesNew.focus()},scrollItemIntoView:function(t){var e=t[0],i=t.parent()[0];if(e){var s=e.getBoundingClientRect().bottom-i.getBoundingClientRect().bottom;0<s&&(i.scrollTop+=s);var n=e.getBoundingClientRect().top-i.getBoundingClientRect().top;n<0&&(i.scrollTop+=n)}},onShowPane:function(){this.open=!0,this.isDetailActive()?(this.detailView.startAutosaveInterval(),this.detailView.focusTextarea()):this.focusNewNote()},onHidePane:function(){this.isFullScreen=!1,this.open=!1,this.isDetailActive()&&this.detailView.clearAutosaveInterval()},isDetailActive:function(){return!!this.detailView},preventCloseOnEsc:function(){return this.isDetailActive()},toggleFullscreen:function(){var t=this;if(this.timeouts.length&&this.timeouts.forEach(function(t){clearTimeout(t)}),this.detailView&&this.detailView.focusTextarea(),this.isFullScreen)this.isFullScreen=!1,this.$el.closest(".app-container").addClass("hide-content"),this.timeouts.push(setTimeout(function(){t.$(".subviews").addClass("u--no-transition"),t.$(".detail-view").addClass("u--no-transition"),t.$el.css({position:"fixed",top:window.innerHeight-t.rect.top,right:t.rect.right,bottom:t.rect.bottom,left:window.innerWidth-t.rect.left}),r.widgetManager.showApps(),t.$(".list-bar").html(""),t.loadList(".list-view")},100)),this.timeouts.push(setTimeout(function(){t.$el.removeClass("fullscreen-textarea"),t.$el.closest(".app-container").removeClass("fullscreen hide-content"),t.$el.css({transition:"",position:"",top:"",right:"",bottom:"",left:""}),t.$el.closest(".app-wrapper").addClass("nipple-bottom-right"),t.addAll()},300)),this.timeouts.push(setTimeout(function(){t.$(".detail-view").removeClass("u--no-transition"),t.$(".subviews").removeClass("u--no-transition")},350));else{var e=this.$el[0].getBoundingClientRect();this.rect={top:e.top,right:window.innerWidth-e.right,bottom:window.innerHeight-e.bottom,left:e.left},this.$el.closest(".app-container").addClass("hide-content"),this.$el.css({position:"fixed",top:this.rect.top,right:this.rect.right,bottom:this.rect.bottom,left:this.rect.left}),this.rect.top=window.innerHeight-this.rect.top,this.rect.left=window.innerWidth-this.rect.left,this.timeouts.push(setTimeout(function(){t.$el.closest(".app-container").addClass("fullscreen"),r.widgetManager.hideAppsExcept(".apps .notes"),t.$(".list-view").html(""),t.listBarOpen&&(t.loadList(".list-bar"),t.addAll()),t.isFullScreen=!0,t.$el.css({transition:"all 200ms ease",top:0,right:0,bottom:0,left:0}),t.$el.closest(".app-wrapper").removeClass("nipple-bottom-right"),t.$el.addClass("fullscreen-textarea")},100)),this.timeouts.push(setTimeout(function(){t.$el.closest(".app-container").removeClass("hide-content")},300))}}}),r.collect.notes=new o.collect.Notes,o.styles.style(),r.views.notes=r.widgetManager.handover("notes",o.views.List,{collection:r.collect.notes,region:"bottom-right",order:"prepend"}),r.widgets.push(r.views.notes),o};m.addinManager&&m.addinManager.registerAddinFn("23c67761-9831-415e-b358-c6844eb6c244",fn_addin);