var fn_addin=function(x,a,t){var e=e||{};return e.styles=e.styles||{},e.commands=e.commands||{},e.dependencies=t||e.dependencies||{},e.styles.style=function(){},e.views=e.views||{},e.collect=e.collect||{},e.models=e.models||{},e.templates=e.templates||{},e.info={widget:!0,placeholderType:"metric",id:"weather",class:"app-container weather",region:"top-right",order:"prepend",addin:"ca27cf32-4c08-4e17-8efe-fe8bf27f3b8e",visibleSetting:"weatherVisible"},x.console.log(x.elapsed()+": "+e.info.id+" started"),e.templates=e.templates||{},e.templates.weather=Handlebars.template({1:function(t,e,a,i){var n,o,l=this.lambda,s=this.escapeExpression,r=e.helperMissing,c="function";return'\t\t\t<span class="icon icon-weather" data-icon="'+s(l(null!=(n=null!=t?t.now:t)?n.icon:n,t))+'" title="'+s(l(null!=(n=null!=t?t.now:t)?n.condition:n,t))+'"></span><span class="metric-stat-number">'+s(l(null!=(n=null!=t?t.now:t)?n.temperature:n,t))+'</span><span class="weather-degree">&deg;</span><span class="unit '+s(typeof(o=null!=(o=e.unitClass||(null!=t?t.unitClass:t))?o:r)===c?o.call(t,{name:"unitClass",hash:{},data:i}):o)+'">'+s(typeof(o=null!=(o=e.unit||(null!=t?t.unit:t))?o:r)===c?o.call(t,{name:"unit",hash:{},data:i}):o)+"</span>\n"},3:function(t,e,a,i){return"\t\t\t&nbsp;\n"},5:function(t,e,a,i){return"loading"},7:function(t,e,a,i){var n;return'<span class="weather-header-message">'+this.escapeExpression("function"==typeof(n=null!=(n=e.displayDay||(null!=t?t.displayDay:t))?n:e.helperMissing)?n.call(t,{name:"displayDay",hash:{},data:i}):n)+"</span>"},9:function(t,e,a,i){var n;return'<span class="weather-header-message">'+this.escapeExpression("function"==typeof(n=null!=(n=e.message||(null!=t?t.message:t))?n:e.helperMissing)?n.call(t,{name:"message",hash:{},data:i}):n)+"</span>"},11:function(t,e,a,i){return'\t\t\t\t\t\t\t\t<li class="weather-attribution no-hover">\n\t\t\t\t\t\t\t\t\t<img class="weather-attribution-logo" src="../img/logo-accuweather.png">\n\t\t\t\t\t\t\t\t</li>\n'},13:function(t,e,a,i){var n;return null!=(n=e.if.call(t,null!=t?t.today:t,{name:"if",hash:{},fn:this.program(14,i,0),inverse:this.noop,data:i}))?n:""},14:function(t,e,a,i){return'<i class="icon-angle-down"></i>'},16:function(t,e,a,i){var n;return'<span class="weather-current-temp">'+this.escapeExpression(this.lambda(null!=(n=null!=t?t.selected:t)?n.temperature:n,t))+"&deg;</span>"},18:function(t,e,a,i){var n,o=this.lambda,l=this.escapeExpression;return'<span class="weather-current-temp">'+l(o(null!=(n=null!=t?t.selected:t)?n.high:n,t))+'&deg;</span><span class="weather-current-temp-low">'+l(o(null!=(n=null!=t?t.selected:t)?n.low:n,t))+"&deg;</span>"},20:function(t,e,a,i){var n,o=this.lambda,l=this.escapeExpression;return'\t\t\t\t<div class="weather-current-details toggle-details">\n\t\t\t\t\t'+(null!=(n=e.if.call(t,null!=t?t.today:t,{name:"if",hash:{},fn:this.program(14,i,0),inverse:this.noop,data:i}))?n:"")+'\n\t\t\t\t\t<div title="'+l(o(null!=(n=null!=t?t.selected:t)?n.hoursOfSun:n,t))+' hours of sun">\n\t\t\t\t\t\t<span class="weather-current-details-title">Feels like</span>\n\t\t\t\t\t\t<span class="weather-current-details-value"  >\n\t\t\t\t\t\t\t'+(null!=(n=e.if.call(t,null!=t?t.today:t,{name:"if",hash:{},fn:this.program(21,i,0),inverse:this.program(23,i,0),data:i}))?n:"")+'\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div title="'+l(o(null!=(n=null!=t?t.selected:t)?n.precipitationExpected:n,t))+" "+l(o(null!=(n=null!=t?t.selected:t)?n.precipType:n,t))+' expected">\n\t\t\t\t\t\t<span class="weather-current-details-title">Chance of '+l(o(null!=(n=null!=t?t.selected:t)?n.precipType:n,t))+'</span>\n\t\t\t\t\t\t<span class="weather-current-details-value">'+l(o(null!=(n=null!=t?t.selected:t)?n.precipChance:n,t))+'%</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div title="Gust '+l(o(null!=(n=null!=t?t.now:t)?n.windGust:n,t))+'">\n\t\t\t\t\t\t<span class="weather-current-details-title">Wind</span>\n\t\t\t\t\t\t<span class="weather-current-details-value">'+l(o(null!=(n=null!=t?t.selected:t)?n.windSpeed:n,t))+" "+(null!=(n=e.if.call(t,null!=(n=null!=t?t.selected:t)?n.windSpeed:n,{name:"if",hash:{},fn:this.program(25,i,0),inverse:this.noop,data:i}))?n:"")+"</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n"},21:function(t,e,a,i){var n;return this.escapeExpression(this.lambda(null!=(n=null!=t?t.selected:t)?n.apparentTemperature:n,t))+"&deg;\n\t\t\t\t\t\t\t"},23:function(t,e,a,i){var n,o=this.lambda,l=this.escapeExpression;return l(o(null!=(n=null!=t?t.selected:t)?n.apparentHigh:n,t))+'&deg;<span class="weather-current-details-value-low">'+l(o(null!=(n=null!=t?t.selected:t)?n.apparentLow:n,t))+"&deg;</span>\n"},25:function(t,e,a,i){var n;return'<svg class="weather-arrow" style="transform: rotate('+this.escapeExpression(this.lambda(null!=(n=null!=t?t.selected:t)?n.windDirection:n,t))+'deg)" xmlns="http://www.w3.org/2000/svg" width="73.168" height="73.168" viewBox="0 0 73.168 73.168"><path d="M58.079 22.316L40.682 1.633A4.581 4.581 0 0 0 37.249 0c-1.392.075-2.599.534-3.485 1.52L15.185 22.204a4.584 4.584 0 0 0 .35 6.468 4.583 4.583 0 0 0 6.472-.354l10.109-11.253v51.531a4.578 4.578 0 0 0 4.584 4.572 4.577 4.577 0 0 0 4.581-4.572v-52.02l9.785 11.63a4.554 4.554 0 0 0 3.509 1.632 4.591 4.591 0 0 0 2.945-1.068 4.58 4.58 0 0 0 .559-6.454z"/></svg>'},27:function(t,e,a,i){var n,o=this.lambda,l=this.escapeExpression;return'\t\t\t<div class="weather-row weather-optional weather-hourly '+(null!=(n=e.if.call(t,null!=t?t.hourlyVisible:t,{name:"if",hash:{},fn:this.program(28,i,0),inverse:this.noop,data:i}))?n:"")+'" >\n\t\t\t\t<div class="weather-forecast weather-forecast-hourly">\n'+(null!=(n=e.each.call(t,null!=t?t.hours:t,{name:"each",hash:{},fn:this.program(30,i,0),inverse:this.noop,data:i}))?n:"")+'\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="weather-row weather-optional weather-detail '+(null!=(n=e.if.call(t,null!=t?t.detailVisible:t,{name:"if",hash:{},fn:this.program(28,i,0),inverse:this.noop,data:i}))?n:"")+'">\n\t\t\t\t<div class="weather-extra">\n\t\t\t\t\t<div class="weather-extra-col">\n\t\t\t\t\t\t<div class="weather-extra-cell" title="Moon '+l(o(null!=(n=null!=t?t.selected:t)?n.moonPhase:n,t))+'">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<span class="weather-current-details-title">Sunrise</span> <span class="weather-current-details-value">'+l(o(null!=(n=null!=t?t.selected:t)?n.sunrise:n,t))+'</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<span class="weather-current-details-title">Sunset</span> <span class="weather-current-details-value">'+l(o(null!=(n=null!=t?t.selected:t)?n.sunset:n,t))+'</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="weather-extra-cell">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<span class="weather-current-details-title">Dewpoint</span> <span class="weather-current-details-value">'+l(o(null!=(n=null!=t?t.selected:t)?n.dewPoint:n,t))+'&deg;</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="pressure-text">\n\t\t\t\t\t\t\t\t<span class="weather-current-details-title">Pressure</span> <span class="weather-current-details-value" '+(null!=(n=e.unless.call(t,null!=(n=null!=t?t.selected:t)?n.pressureDirectionVisible:n,{name:"unless",hash:{},fn:this.program(32,i,0),inverse:this.noop,data:i}))?n:"")+">"+(null!=(n=e.if.call(t,null!=(n=null!=t?t.selected:t)?n.pressureDirectionVisible:n,{name:"if",hash:{},fn:this.program(34,i,0),inverse:this.noop,data:i}))?n:"")+l(o(null!=(n=null!=t?t.selected:t)?n.pressure:n,t))+'</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="weather-extra-col">\n\t\t\t\t\t\t<div class="weather-extra-cell">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<span class="weather-current-details-title">Humidity</span> <span class="weather-current-details-value">'+l(o(null!=(n=null!=t?t.selected:t)?n.humidity:n,t))+'%</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div title="In the past 24 hours">\n\t\t\t\t\t\t\t\t<span class="weather-current-details-title">Precipitation</span> <span class="weather-current-details-value">'+l(o(null!=(n=null!=t?t.selected:t)?n.precipAmount:n,t))+'</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="weather-extra-cell">\n\t\t\t\t\t\t\t<div title="'+l(o(null!=(n=null!=t?t.selected:t)?n.uvIndexText:n,t))+'">\n\t\t\t\t\t\t\t\t<span class="weather-current-details-title">UV Index</span> <span class="weather-current-details-value">'+l(o(null!=(n=null!=t?t.selected:t)?n.uvIndex:n,t))+'</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div title="'+l(o(null!=(n=null!=t?t.selected:t)?n.visibilityText:n,t))+'">\n\t\t\t\t\t\t\t\t<span class="weather-current-details-title">Visibility</span> <span class="weather-current-details-value">'+l(o(null!=(n=null!=t?t.selected:t)?n.visibility:n,t))+'</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="weather-row weather-detail-unavailable '+(null!=(n=e.if.call(t,null!=t?t.unavailableVisible:t,{name:"if",hash:{},fn:this.program(36,i,0),inverse:this.noop,data:i}))?n:"")+'">\n\t\t\t\t<span>Extra info unavailable on extended forecast.</span>\n\t\t\t</div>\n'},28:function(t,e,a,i){return"active"},30:function(t,e,a,i){var n,o=e.helperMissing,l="function",s=this.escapeExpression;return'\t\t\t\t\t<div class="weather-forecast-item" title="'+s(typeof(n=null!=(n=e.condition||(null!=t?t.condition:t))?n:o)===l?n.call(t,{name:"condition",hash:{},data:i}):n)+" ("+s(typeof(n=null!=(n=e.precipChance||(null!=t?t.precipChance:t))?n:o)===l?n.call(t,{name:"precipChance",hash:{},data:i}):n)+"% chance of "+s(typeof(n=null!=(n=e.precipType||(null!=t?t.precipType:t))?n:o)===l?n.call(t,{name:"precipType",hash:{},data:i}):n)+", "+s(typeof(n=null!=(n=e.windSpeed||(null!=t?t.windSpeed:t))?n:o)===l?n.call(t,{name:"windSpeed",hash:{},data:i}):n)+' wind)">\n\t\t\t\t\t\t<div class="weather-forecast-label">'+s(typeof(n=null!=(n=e.hour||(null!=t?t.hour:t))?n:o)===l?n.call(t,{name:"hour",hash:{},data:i}):n)+'</div>\n\t\t\t\t\t\t<span class="icon icon-weather weather-forecast-icon" data-icon="'+s(typeof(n=null!=(n=e.icon||(null!=t?t.icon:t))?n:o)===l?n.call(t,{name:"icon",hash:{},data:i}):n)+'"></span>\n\t\t\t\t\t\t<span class="weather-forecast-high">'+s(typeof(n=null!=(n=e.temperature||(null!=t?t.temperature:t))?n:o)===l?n.call(t,{name:"temperature",hash:{},data:i}):n)+"&deg;</span>\n\t\t\t\t\t</div>\n"},32:function(t,e,a,i){var n;return'title="'+this.escapeExpression(this.lambda(null!=(n=null!=t?t.selected:t)?n.pressureTendency:n,t))+'"'},34:function(t,e,a,i){var n;return'<svg class="weather-arrow weather-arrow-pressure" style="transform: rotate('+this.escapeExpression(this.lambda(null!=(n=null!=t?t.selected:t)?n.pressureDirection:n,t))+'deg)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 73.168 73.168"><path d="M58.079 22.316L40.682 1.633A4.581 4.581 0 0 0 37.249 0c-1.392.075-2.599.534-3.485 1.52L15.185 22.204a4.584 4.584 0 0 0 .35 6.468 4.583 4.583 0 0 0 6.472-.354l10.109-11.253v51.531a4.578 4.578 0 0 0 4.584 4.572 4.577 4.577 0 0 0 4.581-4.572v-52.02l9.785 11.63a4.554 4.554 0 0 0 3.509 1.632 4.591 4.591 0 0 0 2.945-1.068 4.58 4.58 0 0 0 .559-6.454z"/></svg>'},36:function(t,e,a,i){return"show"},38:function(t,e,a,i){var n,o=e.helperMissing,l="function",s=this.escapeExpression;return'\t\t\t<div class="weather-forecast-item weather-forecast-day" data-day="'+s(typeof(n=null!=(n=e.day||(null!=t?t.day:t))?n:o)===l?n.call(t,{name:"day",hash:{},data:i}):n)+'" title="'+s(typeof(n=null!=(n=e.condition||(null!=t?t.condition:t))?n:o)===l?n.call(t,{name:"condition",hash:{},data:i}):n)+'">\n\t\t\t\t<div class="weather-forecast-label">'+s(typeof(n=null!=(n=e.dayShort||(null!=t?t.dayShort:t))?n:o)===l?n.call(t,{name:"dayShort",hash:{},data:i}):n)+'</div>\n\t\t\t\t<span class="icon icon-weather weather-forecast-icon" data-icon="'+s(typeof(n=null!=(n=e.icon||(null!=t?t.icon:t))?n:o)===l?n.call(t,{name:"icon",hash:{},data:i}):n)+'" ></span>\n\t\t\t\t<span class="weather-forecast-high">'+s(typeof(n=null!=(n=e.high||(null!=t?t.high:t))?n:o)===l?n.call(t,{name:"high",hash:{},data:i}):n)+'&deg;</span><span class="weather-forecast-low">'+s(typeof(n=null!=(n=e.low||(null!=t?t.low:t))?n:o)===l?n.call(t,{name:"low",hash:{},data:i}):n)+"&deg;</span>\n\t\t\t</div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,a,i){var n,o,l=this.lambda,s=this.escapeExpression,r=e.helperMissing,c="function";return'\x3c!-- Metric --\x3e\n<div class="app-dash" title="'+s(l(null!=(n=null!=t?t.now:t)?n.condition:n,t))+'">\n\t<div class="metric-stat">\n'+(null!=(n=e.if.call(t,null!=(n=null!=t?t.now:t)?n.icon:n,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?n:"")+'\t</div>\n\t<span class="location metric-label data" title="'+s(typeof(o=null!=(o=e.locationExact||(null!=t?t.locationExact:t))?o:r)===c?o.call(t,{name:"locationExact",hash:{},data:i}):o)+'">'+s(typeof(o=null!=(o=e.location||(null!=t?t.location:t))?o:r)===c?o.call(t,{name:"location",hash:{},data:i}):o)+'</span>\n\t<span class="metric-message">'+s(typeof(o=null!=(o=e.message||(null!=t?t.message:t))?o:r)===c?o.call(t,{name:"message",hash:{},data:i}):o)+'</span>\n</div>\n\n<div class="app-wrapper nipple-top-right">\n\t<div class="app weather-app">\n\n\t\t\x3c!-- Main weather area --\x3e\n\t\t<section class="weather-current">\n\n\t\t\t\x3c!-- Header --\x3e\n\t\t\t<header class="weather-current-header">\n\n\t\t\t\t<span class="weather-current-location '+(null!=(n=e.if.call(t,null!=t?t.loading:t,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?n:"")+'" title="'+s(typeof(o=null!=(o=e.locationExact||(null!=t?t.locationExact:t))?o:r)===c?o.call(t,{name:"locationExact",hash:{},data:i}):o)+'">\n\t\t\t\t\t<span class="weather-location-name">'+s(typeof(o=null!=(o=e.location||(null!=t?t.location:t))?o:r)===c?o.call(t,{name:"location",hash:{},data:i}):o)+"</span>\n\t\t\t\t\t"+(null!=(n=e.unless.call(t,null!=t?t.today:t,{name:"unless",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?n:"")+(null!=(n=e.if.call(t,null!=t?t.message:t,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?n:"")+'<i class="loading-icon"></i>\n\n\t\t\t\t\t<span class="weather-location-icon weather-location-edit"><i class="icon-edit"></i></span>\n\t\t\t\t\t<span class="weather-location-icon weather-location-reset" title="Use location"><svg class="weather-location-reset-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 51.636 51.636"><path d="M51.353.914a.999.999 0 0 0-1.135-.213L.583 23.481a1 1 0 0 0 .252 1.895l22.263 3.731 2.545 21.038a1.002 1.002 0 0 0 1.889.324l24-48.415a1 1 0 0 0-.179-1.14z"/></svg></span>\n\n\t\t\t\t\t<span class="weather-current-conditions">'+s(l(null!=(n=null!=t?t.selected:t)?n.condition:n,t))+'</span>\n\t\t\t\t</span>\n\n\t\t\t\t<div class="more">\n\t\t\t\t\t<div class="icon-wrapper more-toggle">\n\t\t\t\t\t\t<i class="icon-ellipsis more-icon"></i>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="dropdown more-dropdown">\n\t\t\t\t\t\t<ul class="dropdown-list">\n\t\t\t\t\t\t\t<li class="toggle-hourly">\n\t\t\t\t\t\t\t\tHourly forecast\n\t\t\t\t\t\t\t\t<span class="toggle-slider"><svg class="toggle-switch" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50"/></svg></span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="toggle-details">\n\t\t\t\t\t\t\t\tExtra weather info\n\t\t\t\t\t\t\t\t<span class="toggle-slider"><svg class="toggle-switch" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50"/></svg></span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="line"></li>\n\t\t\t\t\t\t\t<li class="toggle-metric">\n\t\t\t\t\t\t\t\tMetric units\n\t\t\t\t\t\t\t\t<span class="toggle-slider"><svg class="toggle-switch" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50"/></svg></span>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t<li class="weather-location-edit-menu">Edit location</li>\n'+(null!=(n=e.if.call(t,null!=t?t.plusDetails:t,{name:"if",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?n:"")+'\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</header>\n\n\t\t\t<div class="weather-current-temp-row">\n\t\t\t\t\x3c!-- Main temp --\x3e\n\t\t\t\t<div class="weather-current-temp-wrapper toggle-hourly">\n\t\t\t\t\t'+(null!=(n=e.if.call(t,null!=t?t.plusDetails:t,{name:"if",hash:{},fn:this.program(13,i,0),inverse:this.noop,data:i}))?n:"")+'\n\t\t\t\t\t<span class="icon icon-weather weather-current-icon" data-icon="'+s(l(null!=(n=null!=t?t.selected:t)?n.icon:n,t))+'" title="'+s(l(null!=(n=null!=t?t.selected:t)?n.condition:n,t))+'"></span>'+(null!=(n=e.if.call(t,null!=t?t.today:t,{name:"if",hash:{},fn:this.program(16,i,0),inverse:this.program(18,i,0),data:i}))?n:"")+"\n\t\t\t\t</div>\n\n\t\t\t\t\x3c!-- Main details --\x3e\n"+(null!=(n=e.if.call(t,null!=t?t.plusDetails:t,{name:"if",hash:{},fn:this.program(20,i,0),inverse:this.noop,data:i}))?n:"")+"\t\t\t</div>\n\n\n\t\t\t\x3c!-- Extra weather info --\x3e\n"+(null!=(n=e.if.call(t,null!=t?t.plusDetails:t,{name:"if",hash:{},fn:this.program(27,i,0),inverse:this.noop,data:i}))?n:"")+'\t\t</section>\n\n\n\n\t\t\x3c!-- 5-day advance forecast --\x3e\n\t\t<section class="weather-row weather-forecast weather-forecast-daily">\n'+(null!=(n=e.each.call(t,null!=t?t.days:t,{name:"each",hash:{},fn:this.program(38,i,0),inverse:this.noop,data:i}))?n:"")+"\t\t</section>\n\t</div>\n</div>\n"},useData:!0}),e.styles=e.styles||{},e.styles.style=function(){var t=document.createElement("style");t.type="text/css",t.innerHTML='.weather{order:0}.weather .app-dash{padding:14px 10px 10px;cursor:pointer;order:1}.weather .location{outline:0}.weather .unit{display:block;position:absolute;left:97%;top:5px;animation:fadeout 4s ease 4s 1 normal;animation-fill-mode:forwards;font-size:55%;text-transform:uppercase}.weather .unit.hide{display:none}.weather .icon-weather{line-height:50%}.weather .metric-stat .icon-weather{margin-right:6px}.weather .icon:before{font-family:MeteoconsRegular;content:attr(data-icon)}@font-face{font-family:MeteoconsRegular;src:url(../font/meteocons.woff2) format("woff2");font-weight:400;font-style:normal}.weather .app{width:400px;padding-bottom:calc(var(--app-padding) - 3px);right:7px;box-sizing:border-box}.weather .icon-angle-down{position:absolute;top:10px;right:8px;font-size:14px;opacity:0}.weather .active .icon-angle-down{transform:rotate(180deg)}.weather-current{padding-top:0!important}.weather-current-header{margin:0;display:flex}.weather-current-location{flex:1 0 auto}.weather-location-name{margin-top:-3px;font-size:19px;outline:0;min-width:32px;min-height:24px;display:inline-block;cursor:pointer}.weather-location-icon{margin-left:-1px;padding:5px;cursor:pointer;opacity:0}.weather-current-location:not(.loading) .weather-location-icon:hover{opacity:1!important}.weather-location-edit{font-size:11px;vertical-align:15%}.weather-current-location:hover .weather-location-edit{opacity:.5}.editing .weather-location-edit{display:none}.weather-location-reset{display:none;opacity:.5}.editing .weather-location-reset{display:inline}.weather-location-reset-icon{height:11px;fill:#fff}.light .weather-location-reset-icon{fill:#999}.weather-header-message{margin:0 5px;opacity:.5}.weather-current-conditions{margin:0 0 12px;display:block;line-height:125%;opacity:.7}.weather-current-location .loading-icon{margin-left:6px;vertical-align:0;display:none}.weather-current-location.loading .loading-icon{display:inline-block}.weather-current-temp-row{margin-bottom:8px;display:flex;cursor:pointer}.weather-current-temp-wrapper{padding-right:22px;position:relative;flex:1 1 50%;box-sizing:border-box;white-space:nowrap}.f--startup .weather-current-temp-wrapper{padding-top:10px}.weather-current-details:hover .icon-angle-down,.weather-current-temp-wrapper:hover .icon-angle-down{opacity:.5}.weather-current-icon{margin-right:10px;font-size:58px;line-height:58px}.weather-current-temp{font-size:60px}.weather-current-temp-low{margin-left:2px;font-size:37.2px;opacity:.6}.weather-current-degree{margin-left:2px;font-size:42px;line-height:60px;opacity:1;vertical-align:top}.weather-current-details{height:70px;margin:0;padding-top:4px;display:flex;flex-direction:column;justify-content:center;position:relative;flex:1 1 50%;box-sizing:border-box;font-size:13px;line-height:135%;transition:opacity .2s ease}.f--startup .weather-current-details{padding-top:25px}.weather-current-details .icon-angle-down{right:0}.weather-current-details-title{margin-right:1px;opacity:.6}.weather-current-details-value{opacity:.9}.weather-current-details-value-low{margin-left:4px;font-size:11px;line-height:100%;opacity:.6}.weather-arrow{height:10px;width:10px;margin-bottom:-1px;fill:#fff;transform:rotate(90deg)}.light .weather-arrow{fill:#000}.weather-optional{height:0;opacity:0;overflow:hidden;transition:all .2s ease}.weather-optional.active{opacity:1}.weather-row{border-top:1px solid rgba(255,255,255,.15)}.light .weather-row{border-top-color:rgba(0,0,0,.1)}.weather-forecast{margin:0;display:flex;font-size:11px}.weather-forecast-item{flex:1 1 11.111%;text-align:center}.weather-forecast-label{margin-bottom:5px;font-size:10px;font-weight:500;opacity:.6;text-transform:uppercase}.weather-forecast-icon{margin-bottom:3px;display:block;font-size:20px;line-height:90%!important;opacity:.85;vertical-align:-20%}.weather-forecast-high{opacity:.85}.weather-forecast-hourly{padding:11px 0;display:flex}.weather-hourly .weather-forecast-item{flex-shrink:0}.weather-forecast-hourly .weather-forecast-high{font-size:11px}.weather-optional.weather-hourly.active{height:75px}.f--startup .weather-optional.weather-hourly.active{height:79px}.weather-forecast-daily{padding-top:8px!important;clear:both;opacity:0;transition:opacity .2s ease}.weather-forecast-daily.active{opacity:1}.weather-forecast-daily .weather-forecast-label{margin:6px 0 3px}.weather-forecast-daily .weather-forecast-icon{margin-right:1px;display:inline-block;font-size:17px}.weather-forecast-daily .weather-forecast-high{padding-right:0}.weather-forecast-daily .weather-forecast-low{padding-left:4px;opacity:.4}.weather-forecast-day{margin:0 1.5px;border-radius:2px;cursor:pointer}.weather-forecast-day:first-child{margin-left:0}.weather-forecast-day:last-child{margin-right:0}.weather-forecast-day.selected,.weather-forecast-day:hover{background:rgba(255,255,255,.09)}.light .weather-forecast-day.selected,.light .weather-forecast-day:hover{background:rgba(0,0,0,.05)}.weather-extra{padding:11px 0;display:flex;font-size:12px}.weather-optional.weather-detail.active{height:90px}.weather-extra-col{flex:1 1 50%}.weather-extra-cell{line-height:135%}.weather-extra-cell:nth-child(odd){margin-bottom:4px}.weather-arrow-pressure{height:9px;width:9px;margin-bottom:0;margin-left:-2px;padding-right:2px}.weather-detail-unavailable{padding:11px 0;display:none;font-size:13px;text-align:center}.weather-detail-unavailable.show{display:block}.weather-detail-unavailable>span{opacity:.5}.weather .more-toggle{margin:calc(-1 * var(--app-padding));padding:var(--app-padding)}.weather .more-dropdown{position:absolute;top:51px;right:14px}.weather .weather-attribution{padding-top:4px;padding-bottom:2px;cursor:default;font-size:10px;opacity:.5}.weather .weather-attribution:hover{background:0 0!important}.weather-attribution-logo{height:10px}.light .weather-attribution-logo{filter:brightness(13%)}',document.getElementsByTagName("head")[0].appendChild(t)},e.views.Weather=Backbone.View.extend({attributes:{id:"weather"},template:e.templates.weather,events:{"paste .weather-location-name":"handlePaste","dblclick .weather-current-location":"editLocation","mousedown .weather-location-reset":"resetLocation","click .weather-location-edit":"editLocation","click .weather-location-edit-menu":"editLocation","click .ready-to-set":"setLocation","click .app-dash":"togglePopup","click .weather-forecast-day":"switchDay","click .toggle-details":"toggleDetails","click .toggle-hourly":"toggleHourly","click .toggle-metric":"toggleUnit","keypress .weather-current-location":"onKeypress","keydown .weather-current-location":"onKeydown","keyup .weather-current-location":"onKeyup","blur .weather-current-location":"saveLocation","webkitAnimationEnd .weather-current-location":"onAnimationEnd","click .more-toggle":"toggleMore"},initialize:function(){var e=this;this.loadingMessage="Loading...",this.today=!0,this.setBaseCodes(),this.setYahooCodes(),this.renderedOnce=!1,this.detailVisible=!1,this.hourlyVisible=!1,this.listenTo(x.models.customization,"change:hour12clock",this.render),this.listenTo(x.models.customization,"change:temperatureUnit",this.render),this.listenTo(x.models.customization,"change:weatherDetail",this.updateDetails),this.listenTo(x.models.customization,"change:weatherHourly",this.updateHourly),this.listenTo(this.model,"change:error",this.renderIfVisible),this.listenTo(this.model,"change:now",this.renderIfVisible),this.listenTo(this.model,"change:location",this.renderIfVisible),this.listenTo(this.model,"change:hours",this.renderIfVisible),this.listenTo(this.model,"change:loading",this.setLoading),this.options.unitClass="hide",this.listenTo(x.models.customization,"change:weatherVisible",this.visibleChanged),this.listenTo(this.model,"change:location",function(){var t=e.model.get("location");t&&t.countryCode&&e.setUnit(t.countryCode)}),this.listenTo(x,"globalEvent:esc globalEvent:click",this.hide),this.render()},handlePaste:function(t){t.preventDefault(),a(t.currentTarget).html("")},updateDetails:function(){var t=this,e=this.detailVisible,a=!0===x.models.customization.get("weatherDetail")&&void 0!==this.model.get("hours")&&x.conditionalFeatures.featureEnabled("plus");e=!0===x.models.customization.get("weatherDetail")&&void 0!==this.model.get("hours")&&x.conditionalFeatures.featureEnabled("plus")&&this.today;var i=(x.models.customization.get("weatherDetail")||x.models.customization.get("weatherHourly"))&&!this.today&&x.conditionalFeatures.featureEnabled("plus");t.$el.find(".weather-detail").toggleClass("active",e),t.$el.find(".toggle-details .toggle-slider").toggleClass("on",a),t.$el.find(".weather-current-details").toggleClass("active",e),t.$el.find(".weather-detail-unavailable").toggleClass("show",i),t.detailVisible=e},updateHourly:function(){var t=this,e=this.hourlyVisible,a=!0===x.models.customization.get("weatherHourly")&&void 0!==this.model.get("hours")&&x.conditionalFeatures.featureEnabled("plus");e=!0===x.models.customization.get("weatherHourly")&&void 0!==this.model.get("hours")&&x.conditionalFeatures.featureEnabled("plus")&&this.today;var i=(x.models.customization.get("weatherDetail")||x.models.customization.get("weatherHourly"))&&!this.today&&x.conditionalFeatures.featureEnabled("plus");t.$el.find(".weather-hourly").toggleClass("active",e),t.$el.find(".toggle-hourly .toggle-slider").toggleClass("on",a),t.$el.find(".weather-current-temp-wrapper").toggleClass("active",e),t.$el.find(".weather-detail-unavailable").toggleClass("show",i),t.hourlyVisible=e},updateDaily:function(){this.$el.find(".weather-forecast-daily").toggleClass("active",this.model.get("daily"))},updateCurrentInfo:function(){this.$el.find(".weather-current-details").toggleClass("active",null!=this.model.get("now").apparentTemperature)},setBaseCodes:function(){var t=this.baseCodes={};t.tornado="F",t.tropicalStorm="F",t.hurricane="F",t.severeThunderstorm="O",t.thunderstorm="P",t.mixedRainAndSnow="X",t.drizzle="Q",t.rain="R",t.freezingRain="X",t.showers="Q",t.sunnyShowers="Q",t.snowFlurries="U",t.snow="W",t.hail="X",t.sleet="X",t.dust="J",t.foggy="M",t.haze="J",t.smoky="M",t.blustery="F",t.windy="F",t.cold="G",t.cloudy="Y",t.mostlyCloudyNight="I",t.mostlyCloudyDay="H",t.partlyCloudyNight="E",t.partlyCloudyDay="H",t.clearNight="C",t.clearDay="B",t.scatteredThunderstorm="O",t.scatteredShowers="Q",t.heavySnow="W",t.thundershowers="O",t.snowShowers="W",t.unknown=")"},setYahooCodes:function(){var t=this.yahooCodes={},e=this.baseCodes;t[0]=e.tornado,t[1]=e.tropicalStorm,t[2]=e.hurricane,t[3]=e.severeThunderstorm,t[4]=e.thunderstorm,t[5]=e.mixedRainAndSnow,t[6]=e.mixedRainAndSnow,t[7]=e.mixedRainAndSnow,t[8]=e.mixedRainAndSnow,t[9]=e.drizzle,t[10]=e.freezingRain,t[11]=e.rain,t[12]=e.rain,t[13]=e.snowFlurries,t[14]=e.snowFlurries,t[15]=e.snowFlurries,t[16]=e.snow,t[17]=e.hail,t[18]=e.sleet,t[19]=e.dust,t[20]=e.foggy,t[21]=e.haze,t[22]=e.smoky,t[23]=e.blustery,t[24]=e.windy,t[25]=e.cold,t[26]=e.cloudy,t[27]=e.mostlyCloudyNight,t[28]=e.mostlyCloudyDay,t[29]=e.partlyCloudyNight,t[30]=e.partlyCloudyDay,t[31]=e.clearNight,t[32]=e.clearDay,t[33]=e.clearNight,t[34]=e.clearDay,t[35]=e.mixedRainAndSnow,t[36]=e.clearDay,t[37]=e.scatteredThunderstorm,t[38]=e.scatteredThunderstorm,t[39]=e.scatteredShowers,t[40]=e.scatteredShowers,t[41]=e.heavySnow,t[42]=e.mixedRainAndSnow,t[43]=e.heavySnow,t[44]=e.partlyCloudyDay,t[45]=e.thundershowers,t[46]=e.snowShowers,t[47]=e.scatteredThunderstorm,t[3200]=e.unknown},show:function(){this.$el.find(".toggle-metric .toggle-slider").toggleClass("on","c"===this.displayUnit()),this.daySelectionActive&&this.$el.find(".weather-forecast-day[data-day='"+this.selectedDayName+"']").first().addClass("selected"),this.model.updateWeather(!0),this.$el.addClass("show"),this.updateDetails(),this.updateHourly(),this.updateCurrentInfo(),this.updateDaily(),this.open=!0;var t=this;x.widgetManager.unfocusOverlap(this.options.region,this.$app.height()),setTimeout(function(){t.$el.addClass("show-fade-in")},5)},hide:function(t){if(!(0<this.$el.find(".upsell-overlay.active").length)&&this.open){if(t&&27===t.keyCode&&this.$el.hasClass("editing"))return this.$location.html(this.model.get("location").locationName),void this.doneEditingLocation();if(t&&a.contains(this.$el.find(".more")[0],t.target)||this.dropdownOpen&&this.toggleMore(),!t||!a.contains(this.$el[0],t.target)){this.$el.removeClass("show-fade-in"),this.open=!1;var e=this;x.widgetManager.refocusOverlap(this.options.region),setTimeout(function(){e.$el.removeClass("show")},250)}}},togglePopup:function(t){this.$el.hasClass("show")?this.hide():this.show()},toggleDetails:function(t){if(t&&t.stopPropagation(),x.conditionalFeatures.featureEnabled("plus"))x.models.customization.set("weatherDetail",!x.models.customization.get("weatherDetail"));else{x.commandManager.execute("upsell.message",{targetRegion:"weather",sourceEvent:"weather-detail",buttonText:"Learn more",title:"Weather Details",description:"Wind, rain, hourly forecast, more accurate feed, and more!"})}},toggleHourly:function(t){if(t&&t.stopPropagation(),x.conditionalFeatures.featureEnabled("plus"))x.models.customization.set("weatherHourly",!x.models.customization.get("weatherHourly"));else{if(a(t.currentTarget).hasClass("weather-current-temp-wrapper"))return;x.commandManager.execute("upsell.message",{targetRegion:"weather",sourceEvent:"weather-hourly",buttonText:"Learn more",title:"Hourly Forecast",description:"See the hour-by-hour forecast for the day"})}},switchDay:function(t){t.stopPropagation(),this.$el.find(".weather-forecast-day").removeClass("selected");var e=t.currentTarget.dataset.day;e!=this.selectedDayName&&(this.selectedDayName=e,this.today=this.model.get("days")[0].day==e,this.daySelectionActive=!0,a(t.currentTarget).addClass("selected"),this.render())},getLastWeatherLocation:function(){var t=localStorage.getItem("last-weather-location");return t?JSON.parse(t):null},render:function(){if(!this.$location||!this.$location.hasClass("editing")){var t="Set Location",e=this.model.get("location")&&this.model.get("location").locationName,a=this.model.get("location")&&this.model.get("location").locationExact,h=this;this.model.get("firstLoad")&&(e+=", "+this.model.get("location").countryCode,setTimeout(function(){h.model.set("firstLoad",!1)},5e3)),e&&0!=e.length||this.model.get("loading")||(e=t);var i,n,o,l,s,r=[],c=[],d=this.model;this.today&&(o=d.get("now")),d.get("days")&&(this.selectedDayName||(this.selectedDayName=d.get("days")[0].day,this.today=!0),this.today?this.selectedDayName=d.get("days")[0].day:l=this.selectedDayName,d.get("days").forEach(function(t){o||t.day!=h.selectedDayName||(o=t),r.push({high:h.calculateDisplayTemperature(t.high),low:h.calculateDisplayTemperature(t.low),condition:t.condition,icon:h.getIconFromCode(t.code,d.get("provider")),unitClass:h.options.unitClass,dayShort:t.day.substr(0,3),day:t.day})})),d.get("hours")&&d.get("hours").forEach(function(t){s=v(t);var e=t.hour.substr(t.hour.indexOf("T")+1,2);c.push({temperature:h.calculateDisplayTemperature(t.temperature),condition:t.condition,icon:h.getIconFromCode(t.code,d.get("provider")),unitClass:h.options.unitClass,hour:x.models.customization.get("hour12clock")?h.convertTo12H(parseInt(e)):e,precipChance:s.chance,precipType:s.type,windSpeed:h.calculateDisplaySpeed(t.windSpeed),windGust:h.calculateDisplaySpeed(t.windGust)})});var u,p=this.model.get("now");if(p){s=v(p);var g=p.sunset?p.sunset.substr(p.sunset.indexOf("T")+1,5):null,m=p.sunrise?p.sunrise.substr(p.sunrise.indexOf("T")+1,5):null,w=x.models.customization.get("hour12clock"),f=0,y=!0;"Falling"==p.pressureTendency?f=180:"Steady"==p.pressureTendency&&(y=!1),n={condition:p.condition,cloudCover:p.cloudCover,windDirection:p.windDirection+180,windSpeed:h.calculateDisplaySpeed(p.windSpeed),windGust:h.calculateDisplaySpeed(p.windGust),temperature:h.calculateDisplayTemperature(d.get("now").temperature),apparentHigh:h.calculateDisplayTemperature(p.apparentHigh),apparentLow:h.calculateDisplayTemperature(p.apparentLow),apparentTemperature:h.calculateDisplayTemperature(p.apparentTemperature),uvIndex:p.uvIndex,uvIndexText:p.uvIndexText,icon:h.getIconFromCode(p.code,d.get("provider")),humidity:p.humidity,dewPoint:h.calculateDisplayTemperature(p.dewPoint),pressure:h.calculateDisplayPressure(p.pressure),pressureTendency:p.pressureTendency,pressureDirection:f,pressureDirectionVisible:y,high:h.calculateDisplayTemperature(p.high),low:h.calculateDisplayTemperature(p.low),sunset:g?w?h.convertTo12H(g.substr(0,2),g.substr(3,2)):g:null,sunrise:m?w?h.convertTo12H(m.substr(0,2),m.substr(3,2)):m:null,moonPhase:p.moonPhase,precipChance:s.chance,precipType:s.type,precipAmount:h.calculateDisplayLength(p.precipAmount),visibility:h.calculateDisplayLongLength(p.visibility),visibilityText:p.visibilityText,precipitationExpected:h.calculateDisplayLength(o.precipitationExpected),hoursOfSun:Math.round(p.hoursOfSun)}}return o==p?u=n:o&&(s=v(o),u={condition:o.condition,cloudCover:o.cloudCover,windDirection:o.windDirection+180,windSpeed:h.calculateDisplaySpeed(o.windSpeed),windGust:h.calculateDisplaySpeed(o.windGust),temperature:h.calculateDisplayTemperature(d.get("now").temperature),apparentHigh:h.calculateDisplayTemperature(o.apparentHigh),apparentLow:h.calculateDisplayTemperature(o.apparentLow),apparentTemperature:h.calculateDisplayTemperature(o.apparentTemperature),uvIndex:o.uvIndex,uvIndexText:o.uvIndexText,icon:h.getIconFromCode(o.code,d.get("provider")),humidity:o.humidity,dewPoint:h.calculateDisplayTemperature(o.dewPoint),pressure:h.calculateDisplayPressure(o.pressure),pressureTendency:o.pressureTendency,pressureDirection:f,pressureDirectionVisible:y,high:h.calculateDisplayTemperature(o.high),low:h.calculateDisplayTemperature(o.low),precipChance:s.chance,precipType:s.type,precipAmount:h.calculateDisplayLength(o.precipAmount),visibility:h.calculateDisplayLongLength(o.visibility),visibilityText:o.visibilityText,precipitationExpected:h.calculateDisplayLength(o.precipitationExpected),hoursOfSun:Math.round(o.hoursOfSun)}),i={location:e,locationExact:a,unit:this.displayUnit(),now:n,selected:u,unitClass:this.options.unitClass,message:this.model.get("error"),days:r,hours:c,plusDetails:0!=this.model.get("providerId"),detailVisible:x.models.customization.get("weatherDetail")&&this.today,hourlyVisible:x.models.customization.get("weatherHourly")&&this.today,unavailableVisible:(x.models.customization.get("weatherDetail")||x.models.customization.get("weatherHourly"))&&!this.today&&x.conditionalFeatures.featureEnabled("plus"),loading:this.model.get("loading"),today:this.today,displayDay:l},this.$el.html(this.template(i)),this.renderedOnce?this.$el.removeClass("show show-fade-in"):x.appsLoaded&&this.$el.mFadeIn(),this.$location=this.$(".weather-location-name"),this.$location.toggleClass("ready-to-set",e===t),this.renderedOnce=!0,this.$app=this.$(".app"),this.open&&(this.$el.addClass("show show-fade-in"),x.widgetManager.unfocusOverlap(this.options.region,this.$app.height()),this.$el.find(".toggle-metric .toggle-slider").toggleClass("on","c"===this.displayUnit()),this.daySelectionActive&&this.$el.find(".weather-forecast-day[data-day='"+this.selectedDayName+"']").first().addClass("selected"),this.updateDetails(),this.updateHourly(),this.updateCurrentInfo(),this.updateDaily()),this.dropdownOpen&&this.toggleMore(),this.loadTriggered||(x.trigger("weather:loaded"),this.loadTriggered=!0),this}function v(t){var e=null==t.high?t.temperature:t.high,a=null==t.low?t.temperature:t.low,i=t.rainProbability,n=t.snowProbability,o=t.iceProbability,l=15<i,s=15<n,r=15<o,c="precip.",d=t.precipitationProbability;return l||s||r?!l||s||r?l||!s||r?l||s||!r||(c="ice",d=o):(c="snow",d=n):(d=i,c="rain"):h.calculateDisplayTemperature(e,!0)<0?(d=n,c="snow"):0<h.calculateDisplayTemperature(a,!0)&&(d=i,c="rain"),{type:c,chance:d}}},setLoading:function(){this.$el.find(".weather-current-location").toggleClass("loading",this.model.get("loading"))},convertTo12H:function(t,e){var a="AM",i=t=parseInt(t);return 12<=i&&(i=t-12,a="PM"),0==i&&(i=12),i+(null==e?"":":"+e)+a},visibleChanged:function(t){x.models.customization.get("weatherVisible")?this.renderedOnce?this.$el.mFadeIn():this.render():this.$el.mFadeOut()},calculateDisplayTemperature:function(t,e){var a=this.model.get("fetchUnit"),i=t;return i||0==i?"c"===this.displayUnit()||e?"c"===a?i:Math.round(5*(i-32)/9):"c"===a?Math.round(9*i/5+32):i:null},calculateDisplaySpeed:function(t){var e=this.model.get("fetchUnit");return t||0==t?"mph"===this.displaySpeedUnit()?("c"===e?Math.round(.62137*t):Math.round(t))+" mph":("c"===e?Math.round(t):Math.round(1.60934*t))+" km/h":null},calculateDisplayPressure:function(t){var e=this.model.get("fetchUnit");return t||0==t?"inHg"===this.displayPressureUnit()?("c"===e?Math.round(.02953*t):t)+" inHg":("c"===e?Math.round(t):Math.round(33.8639*t))+" hPa":null},calculateDisplayLength:function(t){var e=this.model.get("fetchUnit");return t||0==t?"in"===this.displayLengthUnit()?("c"===e?Math.round(.03937*t):t)+" in":("c"===e?Math.round(t):Math.round(25.4*t))+"mm":null},calculateDisplayLongLength:function(t){var e=this.model.get("fetchUnit");return t||0==t?"in"===this.displayLengthUnit()?("c"===e?Math.round(.62137*t):Math.round(t))+" mi":("c"===e?Math.round(t):Math.round(1.60934*t))+" km":null},displayPressureUnit:function(){return"f"==this.displayUnit()?"inHg":"kPa"},displaySpeedUnit:function(){return"f"==this.displayUnit()?"mph":"km/h"},displayLengthUnit:function(){return"f"==this.displayUnit()?"in":"mm"},displayLongLengthUnit:function(){return"f"==this.displayUnit()?"mi":"km"},displayUnit:function(){var t=x.models.customization.get("temperatureUnit");return t||(this.defaultUnit?this.defaultUnit:"c")},setLocation:function(){this.$location.html(""),this.editLocation()},editLocation:function(){this.dropdownOpen&&this.toggleMore(),this.$el.hasClass("editing")||(this.$el.addClass("editing"),this.$location.html()==this.loadingMessage&&this.$location.html(""),this.$location.attr("contenteditable",!0).addClass("editing pulse"),this.selectElementContents(this.$location[0]),this.$location.parent().addClass("editing"))},selectElementContents:function(t){var e=document.createRange();e.selectNodeContents(t);var a=window.getSelection();a.removeAllRanges(),a.addRange(e)},onAnimationEnd:function(t){"pulse"===t.originalEvent.animationName&&this.$location.removeClass("pulse")},onKeypress:function(t){13===t.keyCode&&(t.preventDefault(),this.saveLocation())},resetLocation:function(t){t&&(t.preventDefault(),t.stopPropagation()),this.doneEditingLocation(),localStorage.removeItem("weather-manual"),this.model.set({error:null,firstLoad:!1}),this.model.set({location:null},{silent:!0}),this.model.trigger("change:location");var e=this;setTimeout(function(){e.$el.find(".weather-location-name").html(e.loadingMessage)},50)},saveLocation:function(){if(this.$el.hasClass("editing")){this.doneEditingLocation();var t=this.$location.text().trim();if(this.model.get("location")&&this.model.get("location").locationName&&this.model.get("location").locationName.toLowerCase()==t.toLowerCase())return this.doneEditingLocation(),!0;t&&0<t.length?this.model.getManualLocation(t):this.resetLocation()}},doneEditingLocation:function(){this.$el.removeClass("editing"),this.$location.parent().removeClass("editing"),this.$location.attr("contenteditable",!1).removeClass("editing").addClass("pulse")},toggleUnit:function(t){t&&t.stopPropagation(),this.options.unitClass="","c"===this.displayUnit()?x.models.customization.save("temperatureUnit","f"):x.models.customization.save("temperatureUnit","c")},setUnit:function(t){this.defaultUnit=0<=["US","BM","BZ","JM","PW"].indexOf(t)?"f":"c"},getIconFromCode:function(t,e){return"yahoo"!=e&&e?this.baseCodes[t]:this.yahooCodes[t]},toggleMore:function(){var t=this.$(".more");t.toggleClass("active"),this.dropdownOpen=t.hasClass("active")},renderIfVisible:function(){this.renderedOnce&&this.render()},showUpsell:function(t){this.upsellView&&this.upsellView.remove(),t.template=x.templates.upsell.appupsell,this.upsellView=new x.views.upsell.message(t);var e=this.upsellView.render().$el;this.$el.find(".app").append(e),this.upsellView.show()}}),e.models.Weather=Backbone.Model.extend({defaults:{location:{},now:{},fetchUnit:"c"},initialize:function(){var t,e=this,a=localStorage.getItem("manual-weather-location");(a=JSON.parse(a))&&(this.findPositionByYahooLocationId(a.woeid),t={enteredLocation:a.enteredLocation,locationId:a.woeid,latitude:1,longitude:1,locationName:a.location_name},localStorage.setItem("weather-manual",JSON.stringify(t)),localStorage.removeItem("manual-weather-location"));var i=localStorage.getItem("momentum-weather-1");i=JSON.parse(i);var n=localStorage.getItem("last-weather-location");if(n=JSON.parse(n),i){var o;o=t?{locationId:t.locationId,locationName:t.locationName,latitude:t.latitude,longitude:t.longitude,countryCode:localStorage.getItem("country")}:{locationId:i.woeid,locationName:i.location,latitude:n.latitude,longitude:n.longitude,countryCode:localStorage.getItem("country")};var l={temperature:i.fetchTemperature,condition:i.location,code:i.code};localStorage.setItem("weather",JSON.stringify({location:o,now:l,fetchUnit:i.fetchUnit,providerId:0,provider:"yahoo"})),localStorage.removeItem("momentum-weather-1"),localStorage.removeItem("momentum-weather"),localStorage.removeItem("last-weather-location")}this.loadFromLocalStorage(),(this.get("firstLoad")||this.get("loading"))&&(this.set({firstLoad:!1,loading:!1}),this.store()),setInterval(function(){e.updateWeather()},6e5);var s=this.getSavedManualWeatherLocation();setInterval(function(){e.getSavedManualWeatherLocation()||e.updateCoords()},6e6),this.listenTo(this,"change:providerId",function(){e.store(),e.get("location").locationId=null,e.set({updatedForecast:null,updated:null}),e.store(),e.trigger("change:location")}),this.listenTo(this,"change:location",function(){var t=e.get("location");t&&t.countryCode&&localStorage.setItem("country",t.countryCode),e.updateWeather(!0)}),x.conditionalFeatures.featureEnabled("weatherapi")?this.set("providerId",1):this.set("providerId",0),setTimeout(function(){e.updateWeather(),s||e.updateCoords()},100),window.addEventListener("focus",function(t){e.missedUpdate&&e.updateWeather()})},updateCoords:function(){var e=this;this.getCoordinates(function(t){t.changed&&(e.get("location")||e.set("location",{}),e.get("location").latitude=t.latitude,e.get("location").longitude=t.longitude,e.get("location").locationId=null,e.set({updatedForecast:null,updated:null,error:null}),e.updateWeather())})},store:function(){localStorage.setItem("weather",JSON.stringify(this.attributes))},loadFromLocalStorage:function(){var t=localStorage.getItem("weather");t&&(this.attributes=JSON.parse(t))},updateWeather:function(e,t){if(this.missedUpdate=!document.hasFocus(),!this.missedUpdate){var a=this,i=(new Date).getTime();if(this.get("location")&&this.get("location").latitude){if((!(e&&i-this.get("updatedForecast")<18e5)||t)&&(e||!(i-this.get("updated")<6e5)||t)){var n,o=this.get("location");if(n=e?"forecast":"current",0==this.get("providerId"))this.collectFromYahoo();else{if(this.url=x.globals.urlRoot+"weather/"+n+"?",o.locationId&&0<o.locationId.length)this.url+="locationId="+o.locationId;else{if(1==o.latitude&&1==o.longitude)return void this.updateCoords();this.url+="lat="+o.latitude+"&lon="+o.longitude}this.set("loading",!0),this.fetch({error:function(){a.set("loading",!1)},success:function(){if(e)a.set({loading:!1,updated:i,updatedForecast:i});else{var t=JSON.parse(JSON.stringify(a.attributes));a.loadFromLocalStorage(),Object.assign(a.get("now"),t.now),Object.assign(a.get("location"),t.location),a.set({provider:t.provider,fetchUnit:t.fetchUnit,loading:!1,updated:i})}a.trigger("change:now"),a.trigger("change:loading"),a.store()}})}}}else this.updateCoords()}},findPositionByYahooLocationId:function(t){var n=this,e="https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent("select * from weather.forecast where woeid="+t+' and u="f"')+"&format=json";a.getJSON(e,function(t){if(t&&t.query&&1==t.query.count){var e=t.query.results.channel.item,a=n.getSavedManualWeatherLocation();a.latitude=e.lat,a.longitude=e.long;var i=n.get("location");i.latitude=e.lat,i.longitude=e.long,i.locationId=null,n.updateWeather(!1,!0)}})},collectFromYahoo:function(){if(this.get("location").locationId){var l=this,s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];this.set("loading",!0);var t="https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent("select * from weather.forecast where woeid="+this.get("location").locationId+' and u="f"')+"&format=json";a.getJSON(t,function(t){if(l.set("loading",!1),t&&t.query&&1==t.query.count){var e=t.query.results.channel.item.condition,a=[],i=0;if(t.query.results.channel.item.forecast.forEach(function(t){var e=new Date;e.setDate(e.getDate()+i),++i<6&&a.push({high:t.high,low:t.low,code:t.code,condition:t.text,day:s[e.getDay()],error:null})}),e){var n={high:a[0].high,low:a[0].low,temperature:e.temp,code:e.code,condition:e.text},o=t.query.results.channel.units;l.set({fetchUnit:o.temperature.toLowerCase(),updated:(new Date).getTime(),updatedForecast:(new Date).getTime(),error:null,now:n,days:a,provider:"yahoo",providerId:0}),l.store()}}}).fail(function(t){l.set("loading",!1),console.log("Error getting weather data: "+t)})}else this.getLocationFromYahoo("("+this.get("location").latitude+","+this.get("location").longitude+")")},getManualLocation:function(t){var e=this;0==this.get("providerId")?this.getLocationFromYahoo(t,!0):(this.url=x.globals.urlRoot+"weather/location?location="+t,this.set("loading",!0),this.fetch({error:function(){e.set({loading:!1,error:t+" not found"}),setTimeout(function(){e.set({error:null})},5e3)},success:function(){e.set({loading:!1,error:null});var t=JSON.parse(JSON.stringify(e.attributes.location));e.loadFromLocalStorage(),e.foundLocation(t,!0)}}))},getLocationFromYahoo:function(t,i){this.set("loading",!0);var n=this,e="https://query.yahooapis.com/v1/public/yql?q=SELECT%20*%20FROM%20geo.places%20WHERE%20text%3D%22"+encodeURIComponent(t)+"%22&format=json";function o(t){var e={yahooLocationId:t.woeid};return t.locality1&&t.locality1.content?e.city=t.locality1.content:e.city=t.name,t.country&&(e.countryCode=t.country.code),e.latitude=t.centroid.latitude,e.longitude=t.centroid.longitude,e}a.getJSON(e,function(t){n.set("loading",!1);var e=t.query.count,a=null;1<e?a=o(t.query.results.place[0]):1==e?t.query.results.place&&(a=o(t.query.results.place)):n.set("error","not found"),a&&n.foundLocation({locationName:a.city,latitude:i?a.latitude:n.get("location").latitude,longitude:i?a.longitude:n.get("location").longitude,countryCode:a.countryCode,locationId:a.yahooLocationId},i)}).fail(function(t){console.log("Error getting yahooLocationId"),n.set("loading",!1)})},foundLocation:function(t,e){e&&localStorage.setItem("weather-manual",JSON.stringify(t)),this.set({location:t,updated:null,updatedForecast:null,error:null,manual:1==e,firstLoad:1==e,loading:!1}),this.store(),t.countryCode&&(localStorage.country=t.countryCode)},getSavedManualWeatherLocation:function(){var t=localStorage.getItem("weather-manual");return t?JSON.parse(t):null},getCoordinates:function(a){var i=this;function e(t){if(i.waitingForLocation){i.waitingForLocation=!1,i.set("loading",!1),i.trigger("change:loading"),t&&console.log("Error getting location: "+t.code+", msg: "+t.message);var e=i.getSavedManualWeatherLocation();e?a({latitude:e.latitude,longitude:e.longitude,changed:!1}):i.lastPosition&&(i.lastPosition.changed=n(i.lastPosition),a(i.lastPosition)),i.set("error","")}}function n(t){var e=!0,a=i.get("location");return a&&(+a.latitude).toFixed(2)==(+t.latitude).toFixed(2)&&(+a.longitude).toFixed(2)==(+t.longitude).toFixed(2)&&(e=!1),e}this.get("location")&&this.get("location").latitude||(this.set("loading",!0),this.trigger("change:loading")),this.waitingForLocation=!0,navigator.geolocation.getCurrentPosition(function(t){i.lastPosition={latitude:t.coords.latitude,longitude:t.coords.longitude,changed:n(t.coords)},i.waitingForLocation=!1,i.set("loading",!1),i.trigger("change:loading");try{a(i.lastPosition)}catch(t){console.log(t),e(t)}},e),setTimeout(function(){e()},8e3)}}),e.styles.style(),e.views.countdown=x.widgetManager.handover("weather",e.views.Weather,{model:new e.models.Weather,region:"top-right",order:"prepend"}),x.widgets.push(x.views.weather),e};m.addinManager&&m.addinManager.registerAddinFn("ca27cf32-4c08-4e17-8efe-fe8bf27f3b8e",fn_addin);