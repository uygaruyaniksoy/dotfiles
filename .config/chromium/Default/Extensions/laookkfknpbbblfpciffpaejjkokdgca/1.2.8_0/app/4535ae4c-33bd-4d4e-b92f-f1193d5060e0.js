var fn_addin=function(h,n,t){var c=c||{};return c.styles=c.styles||{},c.commands=c.commands||{},c.dependencies=t||c.dependencies||{},c.styles.style=function(){},c.views=c.views||{},c.collect=c.collect||{},c.models=c.models||{},c.templates=c.templates||{},c.info={id:"base_metric",addin:"4535ae4c-33bd-4d4e-b92f-f1193d5060e0"},h.console.log(h.elapsed()+": "+c.info.id+" started"),c.templates=c.templates||{},c.templates.baseMetric=Handlebars.template({1:function(t,e,i,s){return'\t\t\t\t\t\t\t\t\t\t<li class="archive">Un-archive</li>\n'},3:function(t,e,i,s){return'\t\t\t\t\t\t\t\t\t\t<li class="archive">Archive</li>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,s){var n,a,l=e.helperMissing,r=this.escapeExpression,d="function";return'<div class="app-dash metric-dash metric-dash-empty add-shadow" title="Add a '+r((e.lower||t&&t.lower||l).call(t,null!=t?t.metricType:t,{name:"lower",hash:{},data:s}))+'">\n\t<div class="metric-item">\n\t\t<div class="metric-stat">\n\t\t\t<span class="sets-height">+</span>\n\t\t\t<span class="absolute">\n\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 533.33 533.33"><path d="M516.67,200H333.33V16.67A16.66,16.66,0,0,0,316.67,0h-100A16.67,16.67,0,0,0,200,16.67V200H16.67A16.67,16.67,0,0,0,0,216.67v100a16.66,16.66,0,0,0,16.67,16.66H200V516.67a16.66,16.66,0,0,0,16.67,16.66h100a16.66,16.66,0,0,0,16.66-16.66V333.33H516.67a16.66,16.66,0,0,0,16.66-16.66v-100A16.66,16.66,0,0,0,516.67,200Z"/></svg>\n\t\t\t</span>\n\t\t</div>\n\t\t<div class="metric-label">'+r(typeof(a=null!=(a=e.metricType||(null!=t?t.metricType:t))?a:l)===d?a.call(t,{name:"metricType",hash:{},data:s}):a)+'</div>\n\t</div>\n</div>\n\n<div class="app-dash metric-dash has-multiple add-shadow">\n</div>\n\n<div class="app-wrapper">\n\t<div class="app app-metric nipple-top-right">\n\t\t<div class="subviews-wrapper">\n\t\t\t<div class="subviews">\x3c!--\n\t\t\t--\x3e<div class="subview metric-archive">\n\t\t\t\t<header class="header">\n\t\t\t\t\t<span class="title">Archive</span>\n\t\t\t\t\t<div class="controls">\n\t\t\t\t\t\t<span class="control icon-wrapper back"><i class="icon icon-right"></i></span>\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class="body">\n\t\t\t\t\t<div class="message hidden">\n\t\t\t\t\t\t<span class="loading hidden"><span class="loading-placeholder"></span><span class="loading-label">Loading...</span></span>\n\t\t\t\t\t\t<span class="error hidden">Trouble connectingâ€¦ <span class="action retry">Retry</span></span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<ul class="metric-list">\n\t\t\t\t\t\t\t<li class="empty">\n\t\t\t\t\t\t\t\t<div class="title">No '+r((e.lower||t&&t.lower||l).call(t,null!=t?t.metricTitle:t,{name:"lower",hash:{},data:s}))+' archived</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\n\t\t\t\t</div>\n\t\t\t\t</div>\x3c!--\n\t\t\t\t--\x3e<div class="subview list-view metric-home">\n\t\t\t\t\t<header class="header">\n\t\t\t\t\t\t<span class="title">'+r(typeof(a=null!=(a=e.metricTitle||(null!=t?t.metricTitle:t))?a:l)===d?a.call(t,{name:"metricTitle",hash:{},data:s}):a)+'</span>\n\t\t\t\t\t\t<div class="controls">\n\t\t\t\t\t\t\t<div class="control add">\n\t\t\t\t\t\t\t\t<div class="icon-wrapper">\n\t\t\t\t\t\t\t\t\t<i class="icon-plus"></i>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="control more">\n\t\t\t\t\t\t\t\t<div class="icon-wrapper more-toggle">\n\t\t\t\t\t\t\t\t\t<i class="icon-ellipsis more-icon"></i>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="dropdown more-dropdown">\n\t\t\t\t\t\t\t\t\t<ul class="dropdown-list">\n\t\t\t\t\t\t\t\t\t\t<li class="show-archived">\n\t\t\t\t\t\t\t\t\t\t\tGo to Archive\n\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t<li class="toggle-random" title="Show a random chosen '+r((e.lower||t&&t.lower||l).call(t,null!=t?t.metricType:t,{name:"lower",hash:{},data:s}))+' each load">\n\t\t\t\t\t\t\t\t\t\t\t<span class="setting-title">Show Random</span>\n\t\t\t\t\t\t\t\t\t\t\t<span class="toggle-slider"><svg class="toggle-switch" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50"/></svg></span>\n\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</header>\n\t\t\t\t\t<div class="body">\n\t\t\t\t\t\t<div class="empty">\n\t\t\t\t\t\t\t<div class="title">No '+r((e.lower||t&&t.lower||l).call(t,null!=t?t.metricTitle:t,{name:"lower",hash:{},data:s}))+' yet</div>\n\t\t\t\t\t\t\t<div class="description">'+r(typeof(a=null!=(a=e.metricDescription||(null!=t?t.metricDescription:t))?a:l)===d?a.call(t,{name:"metricDescription",hash:{},data:s}):a)+'</div>\n\t\t\t\t\t\t\t<div class="button add">New '+r(typeof(a=null!=(a=e.metricType||(null!=t?t.metricType:t))?a:l)===d?a.call(t,{name:"metricType",hash:{},data:s}):a)+'</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<ul class="metric-list">\n\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\x3c!--\n\t\t\t\t--\x3e<div class="subview metric-detail metric-detail-add">\n\t\t\t\t\t<header class="header">\n\t\t\t\t\t\t<div class="control">\n\t\t\t\t\t\t\t<div class="icon-wrapper back">\n\t\t\t\t\t\t\t\t<i class="icon icon-left"></i>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-mode controls">\n\t\t\t\t\t\t\t<div class="control more">\n\t\t\t\t\t\t\t\t<div class="icon-wrapper more-toggle">\n\t\t\t\t\t\t\t\t\t<i class="icon-ellipsis more-icon"></i>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="dropdown more-dropdown">\n\t\t\t\t\t\t\t\t\t<ul class="dropdown-list">\n'+(null!=(n=e.if.call(t,null!=t?t.archived:t,{name:"if",hash:{},fn:this.program(1,s,0),inverse:this.program(3,s,0),data:s}))?n:"")+'\t\t\t\t\t\t\t\t\t\t<li class="delete">Delete</li>\n\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</header>\n\t\t\t\t\t<div class="body"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'},useData:!0}),c.templates.defaultInstance=Handlebars.template({1:function(t,e,i,s){var n;return" (Random "+this.escapeExpression("function"==typeof(n=null!=(n=e.metricType||(null!=t?t.metricType:t))?n:e.helperMissing)?n.call(t,{name:"metricType",hash:{},data:s}):n)+")"},3:function(t,e,i,s){var n;return'<span class="list-control list-pin'+(null!=(n=e.if.call(t,null!=t?t.pinned:t,{name:"if",hash:{},fn:this.program(4,s,0),inverse:this.noop,data:s}))?n:"")+'"><svg class="icon icon-pin" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 481.715 481.715"><path d="M470.951 106.124L375.59 10.765c-14.352-14.352-37.611-14.352-51.976 0a36.695 36.695 0 0 0-10.762 25.965c0 7.133 2.114 14.055 5.938 19.961L191.378 166.288c-13.12-6.07-27.472-9.416-42.217-9.416a100.534 100.534 0 0 0-71.104 29.459c-13.763 13.777-13.763 36.086 0 49.863l57.309 57.324L0 481.714l188.197-135.365 57.309 57.31c13.76 13.762 36.1 13.762 49.879 0a100.597 100.597 0 0 0 29.439-71.103c0-14.729-3.327-29.08-9.397-42.186l109.615-127.443c5.889 3.82 12.794 5.938 19.929 5.938a36.684 36.684 0 0 0 25.98-10.777c14.352-14.353 14.352-37.612 0-51.964z"/></svg></span>'},4:function(t,e,i,s){return" active "},6:function(t,e,i,s){return'<span class="list-control list-unarchive"><svg class="icon icon-unarchive" title="Unarchive" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 438.53 438.53"><path d="M421.12,134.19q-17.4-40.54-46.81-69.95t-70-46.82a216.26,216.26,0,0,0-166.3-1.57A221.7,221.7,0,0,0,68.24,60.53L31.12,23.7q-8.57-8.86-19.7-4Q0,24.56,0,36.55v127.9A17.56,17.56,0,0,0,5.43,177.3a17.56,17.56,0,0,0,12.85,5.43h127.9q12,0,16.85-11.42,4.84-11.15-4-19.71l-39.12-39.39a141.7,141.7,0,0,1,45.69-29,144.9,144.9,0,0,1,53.67-10.14A142.56,142.56,0,0,1,276,84.65a144.79,144.79,0,0,1,77.94,77.95,144.69,144.69,0,0,1,0,113.34A144.79,144.79,0,0,1,276,353.89a145,145,0,0,1-172-45.26q-2-2.85-6.57-3.43a10.28,10.28,0,0,0-7.14,2.57l-39.11,39.4A8.49,8.49,0,0,0,48.68,353a10.24,10.24,0,0,0,1.86,6.43,214.2,214.2,0,0,0,75.37,58.38,217.74,217.74,0,0,0,93.36,20.7,213.31,213.31,0,0,0,85.08-17.41q40.54-17.42,69.95-46.82t46.82-69.95a216.59,216.59,0,0,0,0-170.16Z" transform="translate(0 0)"/></svg></span>'},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,s){var n,a,l=e.helperMissing,r="function",d=this.escapeExpression;return'<div class="metric-data" title="'+d(typeof(a=null!=(a=e.tooltip||(null!=t?t.tooltip:t))?a:l)===r?a.call(t,{name:"tooltip",hash:{},data:s}):a)+(null!=(n=e.if.call(t,null!=t?t.random:t,{name:"if",hash:{},fn:this.program(1,s,0),inverse:this.noop,data:s}))?n:"")+'">\n\t<div class="metric-stat-row">\n\t\t<div class="metric-stat">\n\t\t\t<span class="metric-stat-number">'+d(typeof(a=null!=(a=e.time||(null!=t?t.time:t))?a:l)===r?a.call(t,{name:"time",hash:{},data:s}):a)+'</span><span class="metric-stat-unit">'+d(typeof(a=null!=(a=e.unit||(null!=t?t.unit:t))?a:l)===r?a.call(t,{name:"unit",hash:{},data:s}):a)+'</span>\n\t\t</div>\n\n\t\t<div class="list-controls">\n\t\t\t<span class="list-control list-edit"><svg class="icon icon-gear" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 340.274 340.274"><path d="M293.629 127.806l-5.795-13.739c19.846-44.856 18.53-46.189 14.676-50.08l-25.353-24.77-2.516-2.12h-2.937c-1.549 0-6.173 0-44.712 17.48l-14.184-5.719c-18.332-45.444-20.212-45.444-25.58-45.444h-35.765c-5.362 0-7.446-.006-24.448 45.606l-14.123 5.734C86.848 43.757 71.574 38.19 67.452 38.19l-3.381.105-27.27 26.737c-4.138 3.891-5.582 5.263 15.402 49.425l-5.774 13.691C0 146.097 0 147.838 0 153.33v35.068c0 5.501 0 7.44 46.585 24.127l5.773 13.667c-19.843 44.832-18.51 46.178-14.655 50.032l25.353 24.8 2.522 2.168h2.951c1.525 0 6.092 0 44.685-17.516l14.159 5.758c18.335 45.438 20.218 45.427 25.598 45.427h35.771c5.47 0 7.41 0 24.463-45.589l14.195-5.74c26.014 11 41.253 16.585 45.349 16.585l3.404-.096 27.479-26.901c3.909-3.945 5.278-5.309-15.589-49.288l5.734-13.702c46.496-17.967 46.496-19.853 46.496-25.221V151.88c-.005-5.519-.005-7.446-46.644-24.074zM170.128 228.474c-32.798 0-59.504-26.187-59.504-58.364 0-32.153 26.707-58.315 59.504-58.315 32.78 0 59.43 26.168 59.43 58.315-.006 32.177-26.656 58.364-59.43 58.364z"></path></svg></span>\n\n\t\t\t'+(null!=(n=e.unless.call(t,null!=t?t.archived:t,{name:"unless",hash:{},fn:this.program(3,s,0),inverse:this.noop,data:s}))?n:"")+"\n\n\t\t\t"+(null!=(n=e.if.call(t,null!=t?t.archived:t,{name:"if",hash:{},fn:this.program(6,s,0),inverse:this.noop,data:s}))?n:"")+'\n\t\t</div>\n\t</div>\n\t<span class="metric-label">'+d(typeof(a=null!=(a=e.nameOrPlaceholder||(null!=t?t.nameOrPlaceholder:t))?a:l)===r?a.call(t,{name:"nameOrPlaceholder",hash:{},data:s}):a)+"</span>\n</div>\n"},useData:!0}),c.styles=c.styles||{},c.styles.style=function(){var t=document.createElement("style");t.type="text/css",t.innerHTML=".base-metric .app,.base-metric .subview{width:var(--metric-width)}.base-metric{--app-padding:15px;--header-height:47px;padding:0;order:1}.metric-list .metric-label{max-width:none}.base-metric .app-dash{position:relative}.base-metric .add-shadow:before{border-bottom-right-radius:20%}.top-right .base-metric:first-child .app-dash{padding-right:10px}.app-dash .metric-label{opacity:.9}.app-dash .icon-random{display:none}.base-metric .app-wrapper{position:absolute}.base-metric .nipple-top-right:after{right:28px!important}.base-metric .app{--metric-width:220px;right:0;transition:all var(--a--fast) ease,left 0s ease}.base-metric .subviews{min-width:880px;max-width:880px;will-change:max-height;transition:all .3s ease}.base-metric .icon-wrapper{height:100%;padding:0 4px 0 3px}.base-metric .add .icon-wrapper{padding-left:12px}.base-metric .more-toggle{padding-right:12px}.base-metric .icon-wrapper i{min-width:19px;margin-top:-1px;text-align:center}.base-metric .back{padding-left:calc(var(--app-padding) - 3px)}.base-metric .header{height:var(--header-height);margin-bottom:0;display:flex;justify-content:space-between;align-items:center}.base-metric .body{max-height:calc(100% - var(--header-height) - var(--app-padding));padding:0 var(--app-padding) var(--app-padding);overflow:auto}.base-metric.hide-scroll .body{overflow:hidden}.base-metric .metric-list{margin-right:calc((var(--metric-width) - (100% + var(--app-padding) * 2)) * -1)}.metric-list-item{margin:0 0 3px;padding:6px 7px 4px;position:relative;display:flex;justify-content:space-between;border-radius:2px;cursor:pointer}.metric-list-item:last-child{margin-bottom:1px}.metric-list-item:hover{background:rgba(255,255,255,.07)}.metric-list-item.selected{background:rgba(255,255,255,.18)}.light .metric-list-item:hover{background:rgba(0,0,0,.03)}.light .metric-list-item.selected{background:rgba(0,0,0,.08)}.metric-archive .header{position:relative;justify-content:center}.metric-archive .controls{position:absolute;right:0}.metric-archive .back{padding-right:calc(var(--app-padding) - 3px)}.metric-archive .message{min-height:120px;margin:0;padding:var(--app-padding);display:flex;align-items:center;justify-content:center;background:0 0}.metric-archive .hidden,.metric-archive .metric-list{display:none}.metric-archive .metric-list.active{display:block}.metric-home .header{padding-left:var(--app-padding)}.metric-home .more-dropdown{width:201px}.metric-detail .edit-mode{display:none}.metric-detail .edit-mode.visible{display:flex}.metric-edit-controls .save{background:0 0;background:rgba(255,255,255,.4)}.metric-edit-controls .save.disabled{cursor:auto;opacity:.5}.base-metric .create-pinned-group{cursor:pointer}.base-metric .create-pinned-group label{display:inline-block;cursor:pointer;transition:opacity .3s ease}.base-metric .create-pinned-group:hover label{opacity:8}.base-metric .create-pinned-group .toggle-slider{transition:background .3s ease}.base-metric .create-pinned-group:hover .toggle-slider{background:rgba(255,255,255,.45)}.metric-dash-empty{display:none}.app-empty .metric-dash-empty{display:block}.metric-dash-empty .sets-height{visibility:hidden}.metric-dash-empty .absolute{position:absolute;top:0;right:0;bottom:0;left:0;display:flex;justify-content:flex-end;align-items:center}.metric-dash-empty .absolute svg{height:17px;width:17px;fill:#fff}.base-metric .empty{padding:0}.base-metric.app-empty .metric-home .empty{display:flex}.base-metric .loading-icon{vertical-align:-15%}.base-metric .loading-label{font-size:.875rem}",document.getElementsByTagName("head")[0].appendChild(t)},c.views.MetricInstance=Backbone.View.extend({tagName:function(){return"listItem"===this.options.type?"li":"div"},events:{click:"selectMetric","webkitAnimationEnd .metric-instance":"onAnimationEnd","click .list-edit":"editDetail",dblclick:"editDetail","mouseenter .list-random":"enterRandomMetricIcon","mouseleave .list-random":"leaveRandomMetricIcon","click .list-pin":"pinMetric","click .list-unarchive":"unarchive"},initialize:function(t){this.parent=t.parent,this.model=t.model,this.model&&(this.collection=this.model.collection),this.template=t.template||c.templates.defaultInstance,this.class=t.class,this.type=t.type,this.listenTo(this.model,"change",this.onChange),this.listenTo(this.model,"replace",this.onReplace)},editDetail:function(t){t.stopPropagation(),"dash"!==this.type&&this.parent.editDetail(this.model)},onChange:function(){this.model.get("deleted")?this.destroy():this.render()},onReplace:function(t){var e=this.collection||this.model.collection;this.model=e.findWhere({id:t.replacedBy}),this.listenTo(this.model,"change",this.onChange),this.render()},destroy:function(){this.$el.remove(),this.remove()},render:function(){var l=this,r=this.model.getViewData();(r.pinned||this.model.get("selected")||this.model.get("random"))&&(r.active=!0),this.model.get("random")&&(r.random=!0),this.$el.html(this.template(r)),this.$el.addClass(this.class),this.$el.toggleClass("pinned-metric",this.model.get("pinned")),this.$el.toggleClass("random random-metric",this.model.get("random")),this.$el.find(".list-random").toggleClass("active",this.model.get("random"));var d=l.$el.find(".metric-label"),o=l.$el.find(".metric-stat");if("dash"===this.type)if(l.labelWidth&&l.lastLabel===r.nameOrPlaceholder)d.width(l.labelWidth);else{function t(){var t,e,i=c(d),s=c(o),n=2.75*s.width();i.width(n),t=e=i.height();for(var a=0;t===e&&0<t&&a<20;)a++,i.width(i.width()-3),t=i.height();l.lastLabel=r.nameOrPlaceholder,l.labelWidth=i.width()+4,i.remove(),s.remove(),d.width(l.labelWidth)}h.appsReady?t():this.listenTo(h,"appsReady",t)}return this;function c(t){var e=t.clone();return e.css("opacity",0),e.css("position","absolute"),e.appendTo("body"),e}},onAnimationEnd:function(t){"pulse"===t.originalEvent.animationName&&this.$el.removeClass("pulse")},pulse:function(t){this.$el.addClass("pulse")},selectMetric:function(t){if("dash"===this.type)this.parent.togglePopup(this);else{if(t.stopPropagation(),this.model.get("archived"))return;this.model.set({selected:!1},{silent:!0}),this.model.set("selected",!0)}},pinMetric:function(t){t.stopPropagation(),this.model.togglePinned()},unarchive:function(t){t.stopPropagation(),this.model.toggleArchive()}}),c.views.BaseMetric=Backbone.View.extend({attributes:{class:"app-container base-metric metric hide-scroll"},template:c.templates.baseMetric,events:{"click .metric-dash-empty":"addMetricFromDashboard","click .add":"toggleAdding","click .more-toggle":"toggleDropdown","click .show-archived":"showArchived","click .toggle-random":"toggleRandom","click .back":"hideDetail","click .delete":"deleteMetric","click .archive":"toggleArchive","click .add-integration":"addIntegration"},initialize:function(t){if(this.desiredTop=0,this.desiredRight=0,this.isOpen=!1,this.renderedOnce=!1,this.detailViewLoaded=!1,this.listenTo(h,"globalEvent:esc globalEvent:click",this.hide),this.listenTo(h,"globalEvent:window:resize "+t.metricType.toLowerCase()+":resize",this.handleResize),this.listenTo(h.models.customization,"change:themeFont",this.render),this.manager=t.manager,this.detailViewAddin=t.detailViewAddin,this.collection=this.manager.collection,this.metricTitle=t.metricTitle,this.metricType=t.metricType,this.visibleSetting=t.visibleSetting,this.metricDescription=t.metricDescription,this.instanceTemplate=t.instanceTemplate,this.updateInterval=t.updateInterval,this.listenTo(h.models.customization,"change:"+this.visibleSetting,this.visibleChanged),void 0===h.models.customization.get(this.getShowRandomKey())){h.models.customization.set(this.getShowRandomKey(),t.defaultShowRandomState||!1);var e=h.models.customization.get("hideRandomMetric");"undefined"!==e&&"Countdown"===this.metricType&&h.models.customization.get(this.getShowRandomKey(),!e)}this.heightLimit=0,this.currentSubview="second";var n=this;this.listenTo(this.collection,"replace",this.replaceModel),this.listenTo(this.collection,"refresh",function(){n.render()}),this.listenTo(this.collection,"reset",function(t,e,i){n.ready=!0,n.render(i,t)}),this.listenTo(this.collection,"add",function(t,e,i){t.get(t.idAttribute)&&!t.get("archived")&&n.addMetricView(t,i&&i.ignoreRender,!0)}),this.listenTo(this.collection,"remove",function(t,e){n.removeViewsOf(t)}),this.listenTo(this.collection,"change",function(t,e){if(t&&t.get("deleted")&&n.removeViewsOf(t),t){var i=Object.keys(t.changed);if(0<=i.indexOf("selected")&&(t.get("selected")&&n.selectModel(t),t.get("pinned")?t.set({selected:!1},{silent:!0}):this.selectedMetric!==t||this.selectedMetric.get("selected")||(this.selectedMetric.get("pinned")||this.removeFromDash(this.selectedMetric),this.selectedMetric=null,this.selectedMetricId=null)),0<=i.indexOf("pinned"))if(t.get("pinned")){n.renderRandomModel();var s=n.getDashView(t);s||(s=n.addToDash(t)),s.pulse()}else this.selectedMetric!==t&&setTimeout(function(){n.removeFromDash(t)});0<=i.indexOf("archived")&&(t.get("archived")?(t.get("random")&&this.resetCurrentRandom(),n.removeViewsOf(t),n.collection.includeArchived&&n.addOne(t)):(n.removeViewsOf(t),setTimeout(function(){n.addMetricView(t)})))}}),this.collection.fetchedOnce&&(this.ready=!0),this.render(),this.updateInterval&&("onWholeMinute"===this.updateInterval?this.listenTo(h.models.date,"change:date",this.updateViews):setInterval(this.updateViews.bind(this),this.updateInterval))},getCustomizationKey:function(){return this.metricType.toLowerCase()+"Visible"},removeFromDash:function(t,e){if(t){var i=this.getDashView(t);if(i){i.destroy(),delete this.dashViews[t.get(t.idAttribute)],this.dashViewsArray.splice(this.dashViewsArray.indexOf(i),1),e||!this.emptyDash()&&!this.showingRandom()||this.renderRandomModel();var s=this;setTimeout(function(){t.get(t.idAttribute)===s.lastTargetId&&s.show()},50)}}},removeFromList:function(t){if(t){var e=this.getListView(t);e&&(e.destroy(),delete this.listViews[t.get(t.idAttribute)],this.listViewsArray.splice(this.listViewsArray.indexOf(e),1),this.setHeight(),this.isOpen&&this.unfocusOverlap(),this.checkEmptyState())}},checkEmptyState:function(){this.$el.toggleClass("app-empty",this.isListEmpty()),this.setHeight()},isListEmpty:function(e){return 0===this.collection.filter(function(t){return(e?t.get("archived"):!t.get("archived"))&&!t.get("deleted")}).length},removeViewsOf:function(t){this.removeFromDash(t),this.removeFromList(t)},updateViews:function(){function t(t){t.render()}this.dashViews&&this.listViews&&(Object.values(this.dashViews).forEach(t),Object.values(this.listViews).forEach(t))},visibleChanged:function(t){h.models.customization.get(this.visibleSetting)?this.renderedOnce?this.$el.mFadeIn():this.render():this.$el.mFadeOut()},showingRandom:function(){return h.models.customization.get(this.getShowRandomKey())},updateDetails:function(){this.$el.find(".toggle-random .toggle-slider").toggleClass("on",this.showingRandom())},setRandomMetric:function(){this.resetCurrentRandom(!0);var t=this.getCollectionItems(),e=this.getPinned(),i=0===e.length;if(this.selectedMetric&&!this.selectedMetric.get("pinned"))this.cleanRandomFlag();else if(!this.randomModel||0<=e.indexOf(this.randomModel)||t.indexOf(this.randomModel)<0){var s=[];t.forEach(function(t){e.indexOf(t)<0&&!t.get("archived")&&s.push(t)}),(i||this.showingRandom())&&0<s.length?this.randomModel=s[Math.floor(Math.random()*s.length)]:this.cleanRandomFlag()}this.randomModel&&this.randomModel.set("random",!0)},getCollectionItems:function(){var t=this.collection.activeItems?this.collection.activeItems():this.collection.models;return this.collection.sorted||(t=this.sort(t)),t},render:function(t,e,i){if(this.ready){var s=this;if(this.currentHeight=this.$subviews&&this.$subviews.innerHeight(),t&&(t.ignoreRender||t.silent||this.$subviews&&this.$subviews.hasClass("third")))this.$subviews&&this.$subviews.hasClass("third")&&(this.missedRender=!0);else if(this.switching)setTimeout(function(){s.render(t,e,i)},50);else{this.dropdownOpen=!1,this.dashViews={},this.listViews={},this.dashViewsArray=[],this.listViewsArray=[];var n=this.getCollectionItems(),a={metrics:n,showArchive:this.collection.includeArchived,metricType:this.metricType,metricTitle:this.metricTitle,metricDescription:this.metricDescription},l=n[0]&&n[0].getDetailViewVariables()||{};this.selectedMetric&&this.getPinned().indexOf(this.selectedMetric)<0&&(a.selectedMetric=this.selectedMetric),this.setRandomMetric(),a.randomMetric=this.randomModel,a.empty=0===n.length,this.$el.removeClass("show show-fade-in"),this.renderedOnce?this.$el.html(this.template(a)):(this.$el.html(this.template(a)),this.renderedOnce=!0),this.$appDash=this.$el.find(".metric-dash.has-multiple"),this.$metricHomeList=this.$el.find(".metric-home .metric-list"),this.$metricArchiveList=this.$el.find(".metric-archive .metric-list"),this.addAll(a),this.checkEmptyState(),this.detailViewLoaded&&(this.detailView&&(this.detailView.remove(),this.detailView=null),this.getDetailView().then(function(){s.detailView.render(l)})),this.$popup=this.$(".app-wrapper"),this.$app=this.$(".app"),this.isOpen?this.show(e,!0,i):this.lastMetric=this.selectedMetric,this.$subviews=this.$el.find(".subviews").first(),this.$el.addClass(this.metricType.toLowerCase()),this.handleResize(),this.$el.find(".toggle-archived .toggle-slider").toggleClass("on",this.collection.includeArchived),this.updateDetails(),s.loadTriggered||(h.trigger(c.info.id+":loaded"),s.loadTriggered=!0)}}},getDetailView:function(){var i=this;return new Promise(function(e){i.detailView?e():i.detailView=i.createDetailView({el:i.$el.find(".metric-detail .body"),collection:i.collection,parentView:i}).then(function(t){i.detailView=t,e()})})},sort:function(t){var e=t;try{e=t.sort(function(t,e){return!t.get("pinned")||e.get("pinned")?!e.get("pinned")||t.get("pinned")?0:1:-1})}catch(t){}return e},addToDash:function(t,e){if(t){if(this.dashViews[t.get(t.idAttribute)])return this.dashViews[t.get(t.idAttribute)];var i=new(this.instanceView||c.views.MetricInstance)({model:t,class:"metric-item "+(e||""),template:this.instanceTemplate,type:"dash",parent:this}),s=i.render().$el;if(this.emptyDash())this.$appDash.append(s),this.dashViewsArray.push(i);else{var n,a,l=!1,r=this.getCollectionItems(),d=r.indexOf(t);for(n=0;n<r.length;n++){a=r[n];var o=this.getDashView(a);if(d<n&&o){l=!0,o.$el.before(s),this.dashViewsArray.splice(this.dashViewsArray.indexOf(o),0,i);break}}l||(this.$appDash.append(s),this.dashViewsArray.push(i))}return this.dashViews[t.get(t.idAttribute)]=i}},getDashView:function(t){return t?this.dashViews[t.get(t.idAttribute)]:null},getListView:function(t){return t?this.listViews[t.get(t.idAttribute)]:null},resetCurrentRandom:function(t){if(this.randomModel){var e=this.randomModel;this.cleanRandomFlag();var i=this.getListView(e);i&&i.render(),this.removeFromDash(e,t)}},cleanRandomFlag:function(){this.randomModel&&(this.randomModel.set("random",!1),this.randomModel=null)},selectModel:function(t){t.get("pinned")||(this.resetCurrentRandom(!0),this.selectedMetric&&t!==this.selectedMetric&&this.selectedMetric.set("selected",!1),this.selectedMetric=t,this.selectedMetricId=t.get(t.idAttribute));var e=this.getDashView(t);e?e.pulse():this.addToDash(t,"selected-metric"),this.show(t,!0)},addOne:function(t,e){if(!this.listViews[t.get(t.idAttribute)]){e=e||"";var i=new(this.instanceView||c.views.MetricInstance)({model:t,class:"list-item metric-list-item metric-option "+e,template:this.instanceTemplate,type:"listItem",parent:this});return this.listViews[t.get(t.idAttribute)]=i,this.checkEmptyState(),(t.get("archived")?this.$metricArchiveList:this.$metricHomeList).append(i.render().$el),this.listViewsArray.push(i),this.setHeight(),this.isOpen&&this.unfocusOverlap(),i}},addAll:function(t){t.randomMetric?this.addToDash(t.randomMetric,"random-metric"):t.selectedMetric&&this.addToDash(t.selectedMetric,"selected-metric");var e=this,i="";t.metrics.map(function(t){!t.get("pinned")&&t.get("active")&&(i="active"),e.addOne(t,i),t.get("pinned")&&!t.get("archived")&&e.addToDash(t,"pinned-metric")})},createMetric:function(t){var e=this.collection.create(t,{createdNow:!0,ignoreRender:!0});this.addMetricView(e,!1,!0),e.set("selected",!0)},addMetricView:function(t,e,i){if(!this.getListView(t)){if(this.addOne(t,!0),this.switchToListView(),i&&this.resetCurrentRandom(!0),t.get("pinned"))this.addToDash(t,"selected-metric").pulse();this.emptyDash()&&this.renderRandomModel()}},emptyDash:function(){return 0===Object.keys(this.dashViews).length},togglePopup:function(t){this.lastTarget&&this.lastTarget===t?this.hide():this.show(t.model)},getPinned:function(){var t=this.collection.findPinned();return t?Array.isArray(t)||(t=[t]):t=[],t},addMetricFromDashboard:function(){this.isOpen?this.hide():this.show()},getShowRandomKey:function(){return"showRandomMetric-"+this.metricType},renderRandomModel:function(){if(this.setRandomMetric(),this.randomModel){var t=this.getListView(this.randomModel);t&&(t.render(),this.addToDash(this.randomModel,"random-metric"))}this.highlightSelectedMetric()},highlightSelectedMetric:function(t){if(t=t||this.selectedMetric||this.randomModel){this.$el.find(".metric-option").removeClass("selected selected-metric");var e=this.getListView(t);e&&(e.$el.addClass("selected selected-metric"),this.highlightedMetric=t)}},setDetailViewClass:function(t){this.detailViewClass=t},createDetailView:function(i){var s=this;return new Promise(function(e){function t(){var t=new s.detailViewClass(i);e(t)}this.detailViewClass?t():h.widgetManager.loadWidget(s.detailViewAddin).then(function(){t()})})},deleteMetric:function(t){t&&(t.stopPropagation(),t.preventDefault()),this.switchToListView(),this.randomModel===this.activeMetric&&this.cleanRandomFlag(),this.selectedMetric===this.activeMetric&&(this.selectedMetric=null,this.selectedMetricId=null),this.activeMetric.delete(),this.activeMetric=null,this.toggleDropdown()},toggleArchive:function(t){t&&(t.stopPropagation(),t.preventDefault()),this.toggleDropdown(),this.activeMetric.toggleArchive(),this.switchToListView()},addIntegration:function(t){t.stopPropagation(),t.preventDefault(),h.commandManager.execute("settings.toggle",null,{section:"metrics"}),this.hide()},toggleAdding:function(t){var e=this;this.getDetailView().then(function(){e.detailView.startAdding(),e.showDetail(t),e.$el.find(".edit-mode").removeClass("visible")})},show:function(t,e,i){this.dropdownOpen&&this.toggleDropdown();var s,n,a,l,r,d=this;this.$popup.removeClass("animated"),this.isOpen=!0;(n=t?this.getDashView(t):this.lastTargetId?this.dashViews[this.lastTargetId]:this.dashViews[Object.keys(this.dashViews)[0]])&&(this.lastTarget=n,this.lastTargetId=n.model.get(n.model.idAttribute),s=n.$el),s&&0!==s.length?(a=s[0].getBoundingClientRect(),l=this.$el[0].getBoundingClientRect(),r=this.desiredRight,this.desiredRight=l.left-a.left+l.width-a.width-3,this.desiredTop=a.height):(this.desiredRight=-3,this.desiredTop=this.$el.find(".app-dash:visible").first().outerHeight(!0));var o=i||this.currentSubview;if(this.highlightSelectedMetric(t),e)return this.$subviews=this.$el.find(".subviews"),this.$popup.css({right:r||this.desiredRight}),this.$el.addClass("show show-fade-in"),this.$subviews.addClass("u--no-transition"),this.currentHeight&&this.$subviews.css("max-height",this.currentHeight+"px"),this.$subviews.removeClass("u--no-transition"),this.switchTo(o),this.$popup.addClass("animated"),setTimeout(function(){d.$popup.css({right:d.desiredRight,top:d.desiredTop})},1),this.switchTo(this.currentSubview,!0),this.$subviews.addClass("animated"),!0;this.$popup.css({right:this.desiredRight,top:this.desiredTop}),this.$el.addClass("show"),this.$subviews.addClass("u--no-transition"),this.switchTo(o),setTimeout(function(){d.$el.addClass("show-fade-in"),d.$subviews.addClass("animated")},40),this.updateDetails(),this.$subviews.removeClass("u--no-transition")},unfocusOverlap:function(){var i=0;n(this.activeViewElement).children().each(function(t,e){i+=e.clientHeight}),h.widgetManager.unfocusOverlap(this.options.region,i)},switchTo:function(t){var e=this;switch(this.switching=!0,this.currentSubview!==t?(this.$el.addClass("hide-scroll"),setTimeout(function(){e.switching=!1,e.$el.removeClass("hide-scroll")},400)):this.switching=!1,this.$subviews.removeClass("second third"),this.$subviews.addClass(t),this.currentSubview=t){case"second":this.activeViewElement=this.$subviews.children()[1];break;case"third":this.activeViewElement=this.$subviews.children()[2];break;default:this.activeViewElement=this.$subviews.children()[0]}this.isOpen&&this.setHeightLimit(),this.setHeight(),this.unfocusOverlap()},switchToListView:function(){this.switchTo("second")},switchToArchiveView:function(){this.switchTo("")},switchToDetailView:function(){this.switchTo("third")},showDetail:function(t){this.switchToDetailView();var e=this;setTimeout(function(){e.detailView.focus&&e.detailView.focus()},300)},hideDetail:function(t){this.activeMetric&&this.disableBack&&"third"===this.currentSubview?this.detailView&&this.detailView.focus&&this.detailView.focus():(this.switchToListView(),this.activeMetric=null,this.$el.find(".edit-mode").removeClass("visible"))},editDetail:function(t){this.activeMetric=t,this.$el.find(".edit-mode").addClass("visible");var e=this;this.getDetailView().then(function(){e.detailView.editDetail(t),e.showDetail(),e.$el.find(".more-dropdown .archive").html(t.get("archived")?"Unarchive":"Archive")})},hide:function(t){var e=this.$el.find(".more-dropdown")[0];if(!e||t&&n.contains(e,t.target)||this.dropdownOpen&&this.toggleDropdown(),!t||!n.contains(this.$el[0],t.target)&&this.isOpen){this.isOpen=!1,this.lastTarget=null,h.widgetManager.refocusOverlap(this.options.region),this.$el.removeClass("show-fade-in"),this.$el.removeClass("immediate-show");var i=this;setTimeout(function(){i.$el.removeClass("show"),i.switchToListView(),i.missedRender&&i.render()},200)}},setHeight:function(){if(this.$subviews){var t=this.$subviews.hasClass("third")?2:this.$subviews.hasClass("second")?1:0,e=n(this.$subviews.children()[t]),i=e.find(".body");i.css("max-height","none");var s=i.outerHeight(!0)+e.find(".header").outerHeight(!0);i.css("max-height",""),s=s>this.heightLimit?this.heightLimit:s,this.$subviews.css("max-height",s+"px"),this.$el.find(".subview").css("height",this.heightLimit+"px")}},setHeightLimit:function(t){var e=n(".top-row").outerHeight(!0)+n(".bottom").outerHeight(!0),i=n(".bookmarks-wrapper"),s=0;i.css("transform")&&(s=parseInt(i.css("height"))-parseInt(i.css("transform").split(",")[5])),this.heightLimit=document.body.getBoundingClientRect().height-(e+s+4)},handleResize:function(t){this.isOpen&&(this.setHeightLimit(),this.setHeight())},toggleDropdown:function(t){var e;t?(t.stopPropagation(),(e=n(t.currentTarget).parent()).toggleClass("active",!this.dropdownOpen)):e=this.$el,e.find(".more").toggleClass("active",!this.dropdownOpen),this.dropdownOpen=!this.dropdownOpen},showArchived:function(t){t&&t.stopPropagation(),this.$el.find(".metric-archive .error-icon").addClass("hidden"),this.$el.find(".metric-archive .message").addClass("hidden"),this.toggleDropdown();var e=this;e.collection.includeArchived&&e.fetchedArchived||(e.$el.find(".metric-archive .loading").removeClass("hidden"),e.$el.find(".metric-archive .message").removeClass("hidden"),e.$el.find(".metric-archive .loading-placeholder").addClass("loading-icon"),e.collection.includeArchived=!0),e.switchToArchiveView(),e.fetchedArchived?(e.$metricArchiveList.toggleClass("is-empty",this.isListEmpty(!0)),e.$el.find(".metric-archive .metric-list").addClass("active")):(this.$el.find(".metric-archive .metric-list").removeClass("active"),setTimeout(function(){e.collection.fetchFromServer(function(){e.$el.find(".metric-archive .loading").addClass("hidden"),e.$el.find(".metric-archive .message").addClass("hidden"),e.fetchedArchived=!0,e.$el.find(".metric-archive .metric-list").addClass("active");var t=e.collection.where({archived:!0});t.forEach(function(t){t.attributes.random=!1,t.attributes.selected=!1,e.addOne(t)}),e.$metricArchiveList.toggleClass("is-empty",0===t.length),e.setHeight()},function(){e.$el.find(".metric-archive .error").removeClass("hidden"),e.$el.find(".metric-archive .loading").addClass("hidden"),e.fetchedArchived=!0,e.setHeight()})},300)),e.setHeight()},toggleRandom:function(t){t&&t.stopPropagation(),h.models.customization.set(this.getShowRandomKey(),!h.models.customization.get(this.getShowRandomKey())),this.$el.find(".toggle-random .toggle-slider").toggleClass("on"),this.selectedMetric&&this.selectedMetric.set("selected",!1),this.selectedMetric=null,this.selectedMetricId=null,this.renderRandomModel()},nudgeHeight:function(t,e){var i=this,s=this.$el.find(".subviews"),n=s.innerHeight();e&&this.$subviews.addClass("u--no-transition"),s.css("max-height",n+t+"px"),e&&setTimeout(function(){i.$subviews.removeClass("u--no-transition")},10)},setHeightInAnimation:function(){var t=this;this.setHeight(),setTimeout(function(){t.setHeight()},1),setTimeout(function(){t.setHeight()},100)}}),c.styles.style(),c};m.addinManager&&m.addinManager.registerAddinFn("4535ae4c-33bd-4d4e-b92f-f1193d5060e0",fn_addin);