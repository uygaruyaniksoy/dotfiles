class Common{constructor(){this.inputClickType=["button","checkbox","radio","checkbox"],this.retry=auto_click_settings.retry||5,this.retryInterval=1e3*(auto_click_settings.retryInterval||1),this.retryOption=auto_click_settings.retryOption||0,this.checkiFrames=auto_click_settings.checkiFrames||!1}start(t){try{0===this.getNodes().snapshotLength?(this.nodes=void 0,this.retryFunc(t)):this[t]()}catch(t){this.notify(`'${this.xpath}'\n\nClick to fix configuration.`,"Invalid XPath")}}getNodes(){return this.nodes||(this.nodes=document.evaluate(this.xpath,document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null))}retryFunc(t){this.retry>0?(this.retry--,0===this.retryInterval?this.start(t):setTimeout(this.start.bind(this,t),this.retryInterval)):this.checkiFrames?this.loadiFrames(t):this.notFound()}loadiFrames(t){let e=document.getElementsByTagName("iframe");for(let t=0;t<e.length;t++)try{this.nodes&&0!==this.nodes.snapshotLength||(this.nodes=document.evaluate(this.xpath,e[t].contentDocument,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null))}catch(t){console.error(t)}this.nodes&&0!==this.nodes.snapshotLength?this[t]():this.notFound()}notFound(){1==this.retryOption?this.success(`${this.xpath} action Skipped!`):2==this.retryOption&&("complete"===document.readyState?location.reload():window.addEventListener("load",function(){location.reload()})),this.notify(`'${this.xpath}'\n\nClick to fix configuration.`,"XPath not found")}success(t){this.resolve(t)}notify(t,e){browser.runtime.sendMessage({action:"notify",title:e||"Error",message:t,requireInteraction:!0,url:"options_page/index.html"})}error(t){this.reject(t)}}class Action extends Common{constructor(t){super();try{if(this.xpath=t.xpath,null!==new String(t.repeatInterval).match("e")){let e=new String(t.repeatInterval).split("e");this.repeatInterval=1e3*e[0],this.rangeInterval=1e3*e[1]}else this.repeatInterval=1e3*(t.repeatInterval||0);return this.repeat=t.repeat||0,this.value=t.value,t.addon?new Addon(t.addon).then(()=>{this.init(t)}).catch(this.error.bind(this)):this.init(t),new Promise((t,e)=>{this.resolve=t,this.reject=e})}catch(t){this.error(t)}}init(t){if(null!==new String(t.initWait).match("e")){let e=new String(t.initWait).split("e");setTimeout(this.start.bind(this,"click"),Math.floor(Math.random()*e[1]*1e3)+1e3*e[0])}else setTimeout(this.start.bind(this,"click"),1e3*(t.initWait||0))}click(){let t=0;for(;t<this.nodes.snapshotLength;){let i=this.nodes.snapshotItem(t++);var e=document.createEvent("HTMLEvents");e.initEvent("change",!1,!0),this.value&&("SELECT"===i.nodeName||"TEXTAREA"===i.nodeName||"INPUT"===i.nodeName&&-1===this.inputClickType.indexOf(i.type))?(i.value=this.value,i.dispatchEvent(e)):i.click()}this.repeatFunc()}repeatFunc(){this.repeat>0||this.repeat<-1?(this.repeat--,void 0!==this.rangeInterval?setTimeout(this.click.bind(this),Math.floor(Math.random()*this.rangeInterval)+this.repeatInterval):0===this.repeatInterval?this.click():setTimeout(this.click.bind(this),this.repeatInterval)):this.success(`${this.xpath} action executed Successfully!`)}}class Addon extends Common{constructor(t){return super(),this.xpath=t.xpath,this.condition=t.condition,this.value=t.value,new Promise((t,e)=>{this.reject=e,this.resolve=t,this.xpath&&this.condition&&this.value?this.start("check"):this.success(`xpath:${this.xpath} condition:${this.condition} value:${this.value}`)})}check(){let t=0;for(;t<this.nodes.snapshotLength;){let e,i=this.nodes.snapshotItem(t++);e="SELECT"===i.nodeName||"TEXTAREA"===i.nodeName?i.value:"INPUT"===i.nodeName&&-1===this.inputClickType.indexOf(i.type)?i.value:i.innerText,this.checkCondition(e)?this.success(`Condition Success! xPathValue:${e} ${this.condition} value:${this.value}`):this.error(`Condition Failed! xPathValue:${e} ${this.condition} value:${this.value}`)}}checkCondition(t){switch(this.condition){case"Equals":return new RegExp(`^${this.value}$`,"gi").test(t);case"Contains":return new RegExp(`${this.value}`,"gi").test(t);case"GreaterThan":return t>this.value;case"LessThan":return t<this.value;case"GreaterThanEquals":return t>=this.value;case"LessThanEquals":return t<=this.value;default:return this.error(`${this.condition} condition not found`),!1}}}class Batch{constructor(t){try{if(null!==new String(t.repeatInterval).match("e")){let e=new String(t.repeatInterval).split("e");this.repeatInterval=1e3*e[0],this.rangeInterval=1e3*e[1]}else this.repeatInterval=1e3*(t.repeatInterval||0);if(this.refresh=t.refresh||!1,this.repeat=t.repeat,this.actions=t.actions,this.actionLength=0,null!==new String(t.initWait).match("e")){let e=new String(t.initWait).split("e");setTimeout(this.action.bind(this),Math.floor(Math.random()*e[1]*1e3)+1e3*e[0])}else setTimeout(this.action.bind(this),1e3*(t.initWait||0));return new Promise((t,e)=>{this.resolve=t,this.reject=e})}catch(t){this.error(t)}}action(){if(this.actionLength<this.actions.length){let t=this.actions[this.actionLength];new Action(t).then(t=>{this.actionLength++,this.action()}).catch(this.error.bind(this))}else this.repeatFunc()}repeatFunc(){this.repeat>0||this.repeat<-1?(this.actionLength=0,void 0!==this.rangeInterval?setTimeout(this.action.bind(this),Math.floor(Math.random()*this.rangeInterval)+this.repeatInterval):0===this.repeatInterval?this.action():setTimeout(this.action.bind(this),this.repeatInterval),this.repeat--):(this.success("Batch executed Successfully!"),this.refresh&&location.reload())}success(t){this.resolve(t)}error(t){this.reject(t)}}function handleResponse(t){new Processor(t.response)}function getConfigs(){browser.runtime.sendMessage({action:"configs",URL:document.location.href,frameElement:window.frameElement},handleResponse)}chrome&&(browser=chrome),document.addEventListener("DOMContentLoaded",function(){browser.runtime.sendMessage({action:"settings"},function(t){auto_click_settings=t.response,1==auto_click_settings.load&&getConfigs()})}),window.addEventListener("load",function(){browser.runtime.sendMessage({action:"settings"},function(t){auto_click_settings=t.response,1!=auto_click_settings.load&&getConfigs()})});class Processor{constructor(t){t.enable?t.startTime&&t.startTime.match(/^\d{2}:\d{2}:\d{2}$/)?this.schedule(t):(this.record=t,new Batch(t).then(this.success.bind(this)).catch(this.error.bind(this))):t.expired&&browser.runtime.sendMessage({action:"notify",title:"Auto Click",message:"Your Auto Click PRO License is expired",requireInteraction:!0,url:"options_page/index.html"})}schedule(t){var e=new Date;e.setHours(t.startTime.split(":")[0]),e.setMinutes(t.startTime.split(":")[1]),e.setSeconds(t.startTime.split(":")[2]),setTimeout(()=>{this.record=t,new Batch(t).then(this.success.bind(this)).catch(this.error.bind(this))},e.getTime()-(new Date).getTime())}success(t){let e=this.record,i=!1;t:for(let t in e)if("actions"==t){for(let t in e.actions)for(let s in e.actions[t])if(-1!==["initWait","repeat","repeatInterval"].indexOf(s)&&0!=e.actions[t][s]){i=!0;break t}}else if(-1!==["initWait","repeat","repeatInterval"].indexOf(t)&&0!=e[t]){i=!0;break t}let s=[`ProBatch:${i}`];browser.runtime.sendMessage({action:"ga",event:s})}error(t){console.error(t.stack||t)}}function setxPathAndURL(t,e){browser.runtime.sendMessage({action:"setxPathAndURL",URL:e.view.document.URL,xpath:t})}function getPathTo(t){if(""!==t.id)return`//*[@id="${t.id}"]`;if(t===document.body)return`html/${t.tagName.toLowerCase()}`;for(var e=1,i=t.parentNode.childNodes,s=0;s<i.length;s++){var n=i[s];if(n===t)return getPathTo(t.parentNode)+`/${t.tagName.toLowerCase()}[${e}]`;1===n.nodeType&&n.tagName===t.tagName&&e++}}document.addEventListener("mousedown",function(t){if(2==t.button){setxPathAndURL(getPathTo(t.target),t)}},!0);