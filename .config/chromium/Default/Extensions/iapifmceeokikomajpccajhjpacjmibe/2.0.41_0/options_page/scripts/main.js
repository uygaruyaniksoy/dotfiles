class Common{init(t,s){this.container=t,this.target=$(t),Util.ajax(s).then(t=>{this.target.append(t),this.setElements(),this.setEvents(),this.updateDOM()})}saveData(){let t={};this.keys.forEach(s=>{this[s].is("input[type=checkbox]")?t[s]=this[s].is(":checked"):this[s].length>1&&$(this[s][0]).is("input[type=radio]")?t[s]=$("input[name='"+this[s][0].name+"']:checked").val():t[s]=this[s].val()}),Data.getInst()[`${this.db.put}`](this.keys,t),"function"==typeof this.saveCallback&&this.saveCallback(t)}setElements(){this.keys.forEach(t=>{this[t]=this.target.find(`[prop=${t}]`)})}setEvents(){this.keys.forEach(t=>{this[t].on("change",t=>{this.saveData(),"function"==typeof this.setCallbackEvents&&this.setCallbackEvents(t)})})}clearDOM(){this.keys.forEach(t=>{this[t].is("input[type=checkbox]")?this[t].prop("checked",!1):this[t].is("input[type=radio]")?$(this[t][0]).prop("checked",!0):this[t].val("")})}updateDOM(){this.clearDOM();let t=Data.getInst()[`${this.db.get}`]();t&&this.keys.forEach(s=>{this[s].is("input[type=checkbox]")?this[s].prop("checked",t[s]):this[s].is("input[type=radio]")?$(this[s].get(t[s]||0)).prop("checked",!0):this[s].val(t[s])}),"function"==typeof this.updateCallbackDOM&&this.updateCallbackDOM(t)}}
class Action{constructor(){this.keys=["initWait","value","xpath","repeat","repeatInterval"]}static getInst(){return this.inst||(this.inst=new Action)}init(t,e,i){return new Promise((n,a)=>{try{this.container=t,this.target=$(t),Util.ajax(e).then(t=>{this.target.append(t),Util.ajax(i).then(t=>{this.template=t,this.setElements(),this.setEvents(),this.updateDOM(),n(this)})})}catch(t){a(t)}})}setElements(){this.configs=this.target.find("tbody")}setEvents(){$(document).on("click",`${this.container} [prop=remove]`,this.remove.bind(this)),$(document).on("click",`${this.container} [prop=create]`,()=>{let t=this.configs.find("tr").length;Data.getInst().addAction(t),this.createDOM.call(this,t)}),$(document).on("click",`${this.container} [prop=addon]`,this.addon.bind(this)),this.keys.forEach(t=>{$(document).on("keyup",`${this.container} [prop=${t}]`,this.saveData.bind(this))})}remove(t){t.stopPropagation(),this.removeIndex=$(t.currentTarget).parents("tr").index();let e=$(t.currentTarget).parents("tr").find("[prop=xpath]").val()||`${this.removeIndex} action`;Modal.getInst().removeAction(this.removeConfirm.bind(this),e)}removeConfirm(){Data.getInst().removeAction(this.removeIndex),this.configs.find(`tr:eq(${this.removeIndex})`).remove()}createDOM(t,e){if(void 0!==t&&0!==this.configs.find(`tr:eq(${t})`).length||this.configs.append(this.template),e){let t=this.configs.find("tr:last-child").index();this.configs.find("tr:last-child [prop=xpath]").val(e),Data.getInst().saveAction("xpath",e,t)}$('[data-toggle="popover"]').popover()}addon(t){this.addonIndex=$(t.currentTarget).parents("tr").index(),Addon.getInst().launch(this.addonIndex)}saveData(t){let e=$(t.currentTarget),i=e.attr("prop"),n=e.val(),a=e.parents("tr"),s=a.index();Data.getInst().saveAction(i,n,s),this.saveCallack(e,a,n)}saveCallack(t,e,i){let n=!!i;t.is("[prop=value]")?e.find("[prop=repeat],[prop=repeatInterval]").prop("disabled",n):t.is("[prop=repeat]")&&e.find("[prop=value]").prop("disabled",n)}clearDOM(){this.configs.html("")}updateDOM(){this.clearDOM();let t=Data.getInst().getActions();for(let e in t)this.createDOM(e),this.keys.forEach(i=>{let n=this.configs.find(`tr:eq(${e}) [prop=${i}]`);n.length&&t[e][i]&&(n.is("[type=checkbox]")?n.prop("checked",t[e][i]):n.val(t[e][i]),this.afterUpdateDOM(i,e))}),t[e].addon&&t[e].addon.xpath&&t[e].addon.condition&&t[e].addon.value?this.configs.find(`tr:eq(${e})`).addClass("addon"):this.configs.find(`tr:eq(${e})`).removeClass("addon")}afterUpdateDOM(t,e){"value"===t?this.configs.find(`tr:eq(${e})`).find("[prop=repeat],[prop=repeatInterval]").prop("disabled",!0):"repeat"===t&&this.configs.find(`tr:eq(${e}) [prop=value]`).prop("disabled",!0)}}
class Addon{constructor(){this.keys=["xpath","condition","value"],this.db={get:"getAddon",put:"saveAddon"}}init(t,s){this.container=t,this.target=$(t),Util.ajax(s).then(t=>{this.target.append(t)})}static getInst(){return this.inst||(this.inst=new Addon)}launch(t){this.actionIndex=t,$(`${this.container} .modal`).modal({}),this.setElements(),this.setEvents(),this.updateDOM()}saveData(){let t={};this.keys.forEach(s=>{this[s].is("input[type=checkbox]")?t[s]=this[s].is(":checked"):t[s]=this[s].val()}),Data.getInst()[`${this.db.put}`](t,this.actionIndex),"function"==typeof this.saveCallack&&this.saveCallack(t)}saveCallack(t){let s=Action.getInst().configs.find(`tr:eq(${this.actionIndex})`);t.xpath&&t.condition&&t.value?s.addClass("addon"):s.removeClass("addon")}setElements(){this.keys.forEach(t=>{this[t]=this.target.find(`[prop=${t}]`)})}setEvents(){this.keys.forEach(t=>{this[t].on("change",t=>{this.saveData(),"function"==typeof this.setCallbackEvents&&this.setCallbackEvents(t)})})}clearDOM(){this.keys.forEach(t=>{this[t].is("input[type=checkbox]")?this[t].prop("checked",!1):this[t].val("")})}updateDOM(){this.clearDOM();let t=Data.getInst()[`${this.db.get}`](this.actionIndex);t&&this.keys.forEach(s=>{this[s].is("input[type=checkbox]")?this[s].prop("checked",t[s]):this[s].val(t[s])}),"function"==typeof this.updateCallbackDOM&&this.updateCallbackDOM(t)}}
class Batch extends Common{constructor(){super(),this.db={get:"getConfig",put:"saveConfig"},this.keys=["startTime","initWait","repeat","repeatInterval"]}static getInst(){return this.inst||(this.inst=new Batch)}}
class Config extends Common{constructor(){super(),this.keys=["url","enable","refresh"],this.db={get:"getConfig",put:"saveConfig"}}static getInst(){return this.inst||(this.inst=new Config)}saveCallback(e){Sidebar.getInst().updateDOMName(e.url)}setCallbackEvents(e){"enable"===$(e.target).attr("prop")&&($("main").removeClass("disabled"),$(e.target).is(":checked")||$("main").addClass("disabled"))}updateCallbackDOM(e){$("main").removeClass("disabled"),e&&!e.enable&&$("main").addClass("disabled")}}
class Data{constructor(t=0){this.index=t;let i=Storage.getItem("examples");localStorage.configs&&0!=Storage.getItem("configs").length&&(i=Storage.getItem("configs")),this.data=i}static getInst(t){return this.inst||(this.inst=new Data(t))}addConfig(t){this.data[t]={enable:!0,actions:[{}]},Storage.setItem("configs",this.data)}saveConfig(t,i){t.forEach(t=>{this.data[this.index][t]=i[t]}),Storage.setItem("configs",this.data)}removeConfig(t){this.data.splice(t,1),Storage.setItem("configs",this.data)}setConfigIndex(t){this.index=t,Config.getInst().updateDOM(),Batch.getInst().updateDOM(),Action.getInst().updateDOM()}getConfigIndex(){return this.index}setConfigURL(t){if(t){let i=!1;if(this.data.forEach((s,a)=>{if(s.url===t)return this.index=a,i=!0,!0}),!i){let i=this.data.length;this.index=i,this.data[i]={enable:!0,url:t},Storage.setItem("configs",this.data)}}}getConfig(){return this.data[this.index]}getConfigs(){return this.data}saveConfigs(t){this.data=t,Storage.setItem("configs",t)}getActions(){return this.data[this.index].actions||[]}saveAction(t,i,s){this.data[this.index].actions?this.data[this.index].actions[s]||(this.data[this.index].actions[s]={}):(this.data[this.index].actions=[],this.data[this.index].actions[s]={}),this.data[this.index].actions[s][t]=i,Storage.setItem("configs",this.data)}addAction(t){this.data[this.index].actions||(this.data[this.index].actions=[]),this.data[this.index].actions[t]={},Storage.setItem("configs",this.data)}removeAction(t){this.data[this.index].actions.splice(t,1),Storage.setItem("configs",this.data)}getAddon(t){return this.data[this.index].actions[t].addon}saveAddon(t,i){this.data[this.index].actions[i].addon=t,Storage.setItem("configs",this.data)}getSettings(t){return Storage.getItem("settings")}saveSettings(t,i){Storage.setItem("settings",i)}}
class Element{static A(t,e,r,a){let n=document.createElement("A");return n.setAttribute("target","_blank"),n.setAttribute("href",e),n.setAttribute("id",a),n.className+=r,n.innerHTML=" "+t,$(n)}static LI(t){let e=document.createElement("li");return e.className+=t,$(e)}static SPAN(t,e,r){let a=document.createElement("span");return a.className+=e,a.innerHTML=t,a.setAttribute("id",r),$(a)}static H6(t,e,r){let a=document.createElement("h6");return a.className+=e,a.innerHTML=t,a.setAttribute("id",r),$(a)}static ICON(t){let e=document.createElement("i");return e.className+=t,$(e)}}
class Footer{constructor(t,e){return new Promise((r,a)=>{Util.ajax(e).then(e=>{$(t).append(e),r()}).catch(t=>{a(t)})})}}
class Header{constructor(e,a){return new Promise((r,t)=>{Util.ajax(a).then(a=>{$(e).append(a),r()}).catch(e=>{t(e)})})}}
class Main{constructor(){new Header("header","./template/header.html").then(()=>{Purchase.getInst().init().then(t=>{Mode.getInst().init("#mode",t)}).catch(()=>{Mode.getInst().init("#mode")})}),new Footer("footer","./template/footer.html"),Setting.getInst().init("#settings-modal-container","./template/settings-modal.html"),(new Query).then(t=>{Config.getInst().init("#config","./template/config.html"),Batch.getInst().init("#batch","./template/batch.html"),Sidebar.getInst().init("#sidebar","./template/sidebar-li.html","./template/sidebar.html"),Action.getInst().init("#action","./template/action-head.html","./template/action-body.html").then(e=>{t.xpath&&(e.createDOM(void 0,t.xpath),setTimeout(()=>{location.search=""},100))}),Modal.getInst().init("#modal","./template/modal.html"),Addon.getInst().init("#addon-modal","./template/addon-modal.html")})}}function block(){$(document).keydown(function(t){return 123!=t.keyCode&&((!t.ctrlKey||!t.shiftKey||73!=t.keyCode)&&void 0)}),$(document).on("contextmenu",function(t){t.preventDefault()}),$(document).on("focus",".form-control",function(t){$(t.target).parents("tr").addClass("hovered")}),$(document).on("blur",".form-control",function(t){$(t.target).parents("tr").removeClass("hovered")})}window.onload=function(){new Main;block()};
class Modal{static getInst(){return this.inst||(this.inst=new Modal)}init(t,i){this.container=t,this.target=$(t),Util.ajax(i).then(t=>{this.target.append(t),this.setElement()})}setElement(){this.title=this.target.find(".modal-title"),this.body=this.target.find(".modal-body"),this.successBtn=this.target.find(".btn-primary"),this.cancelBtn=this.target.find(".btn-secondary")}removeConfiguration(t,i){this.titleMsg="Remove Configuration",this.bodyMsg=`Are you sure you want to remove configuration for <b>${i}</b>?`,this.launch(t)}removeAction(t,i){this.titleMsg="Remove Action",this.bodyMsg=`Are you sure you want to remove action for <b>${i}</b>?`,this.launch(t)}subscribe(t,i,s){this.titleMsg="Subscription",this.bodyMsg=s,this.successBtn.html("Subscribe"),this.cancelBtn.html("Cancel"),this.launch(t,i)}launch(t,i=(()=>{})){this.title.html(this.titleMsg),this.body.html(`<p>${this.bodyMsg}</p>`),this.successBtn.off("click").on("click",t),this.cancelBtn.off("click").on("click",i),$(`${this.container} .modal`).modal({})}}
class Mode{constructor(){this.key="mode"}static getInst(){return this.inst||(this.inst=new Mode)}init(e,t=0){this.setElement(e),this.setEvents(),this.update(0!==t&&localStorage.getItem(this.key)||"LITE")}setElement(e){this.target=$("body"),this.element=$(e)}setEvents(){this.element.on("change",this.change.bind(this))}update(e="LITE"){Purchase.getInst()&&0===Purchase.getInst().purchases&&"PRO"===e?(new Subscription).subscribeModal().then(t=>{localStorage.setItem(this.key,e),location.reload()}).catch(e=>{console.error(e),this.element.prop("checked",!1)}):(this.target.attr("mode",e),localStorage.setItem(this.key,e),this.element.prop("checked","PRO"===e))}change(e){this.update(e.target.checked?"PRO":"LITE")}}
class Purchase{constructor(){this._purchases=[]}static getInst(){return this.inst||(this.inst=new Purchase)}init(){return new Promise((s,e)=>{this.resolve=s,this.reject=e,chrome.identity.getProfileUserInfo(s=>{chrome.runtime.sendMessage({action:"localStorage",type:"GET",key:"test"},e=>{e=e.response,""!=s.email&&-1!==e.indexOf(s.email)?this.onPurchases({response:{details:[{state:"ACTIVE"}]}}):google.payments.inapp.getPurchases({parameters:{env:"prod"},success:this.onPurchases.bind(this),failure:this.onPurchasesFail.bind(this)})})})})}set purchases(s){for(let e in s.response.details){let t=s.response.details[e];"ACTIVE"===t.state&&this._purchases.push(t)}}get purchases(){return this._purchases.length}onPurchases(s){this.purchases=s,this.resolve(this.purchases)}onPurchasesFail(s){console.error(s),this.reject()}}
class Query{constructor(){return new Promise((t,e)=>{try{let o={};if(location.search){let t=location.search.replace("?","").split("&");for(let e in t){let[r,c]=t[e].split("=");o[r]=decodeURIComponent(c)}}Data.getInst().setConfigURL(o.url),t(o)}catch(t){e(t)}})}}
class Setting extends Common{constructor(){super(),this.db={get:"getSettings",put:"saveSettings"},this.keys=["checkiFrames","load","retry","retryInterval","retryOption","notifications"]}setEvents(){super.setEvents(),this.target.find("#export").on("click",this.exportConfig),this.target.find("#import").on("change",this.importConfig.bind(this))}static getInst(){return this.inst||(this.inst=new Setting)}exportConfig(){var t=JSON.stringify(Data.getInst().getConfigs()),e="data:application/json;base64,"+btoa(t);chrome.downloads.download({url:e,filename:Storage.getItem("manifest").name.replace("/","")+"_Configuration.json"})}importConfig(t){var e=t.currentTarget.files;if(e.length<=0)return!1;var n=new FileReader;n.onload=function(t){try{var e=JSON.parse(t.target.result);this.validateConfig(e)?(Data.getInst().saveConfigs(e),location.reload()):alert("Invalid Configuration")}catch(t){alert("Invalid Configuration"),console.error(t)}}.bind(this),n.readAsText(e.item(0))}validateConfig(t){return t instanceof Array&&t.length>0}}
class Sidebar{constructor(){this.index=Data.getInst().getConfigIndex(),this.keys=["index","name"]}static getInst(){return this.inst||(this.inst=new Sidebar)}init(t,e,i){this.container=t,this.target=$(t),Util.ajax(i).then(t=>{this.target.append(t),Util.ajax(e).then(t=>{this.template=t,this.setElement(),this.updateDOM(),this.setEvents()})})}setElement(){this.configs=this.target.find("ul.list-group")}setEvents(){$(document).on("click",`${this.container} [prop=create]`,()=>{let t=this.configs.find("li").length;Data.getInst().addConfig(t),this.createDOM({name:`new-${t}`,index:t})}),$(document).on("click",`${this.container} li`,this.open.bind(this)),$(document).on("click",`${this.container} [prop=remove]`,this.remove.bind(this))}clearDOM(){this.configs.html("")}updateDOM(){this.clearDOM(),Data.getInst().getConfigs().forEach((t,e)=>{let i=this.getName(t.url,e);this.createDOM({name:i,index:e})}),this.setActive()}createDOM(t){let e=this.template;return this.keys.forEach(i=>{e=e.replace(new RegExp(`{{${i}}}`,"g"),t[i])}),this.configs.append(e),$(e)}getName(t,e){let i=`new-${e}`;return t&&null!==t.match("://.*/")?i=t.split("/")[2]:t&&(i=t),i}setActive(){this.configs.find("li.active").removeClass("active"),this.configs.find(`li[id=${this.index}]`).addClass("active")}open(t){this.index=$(t.currentTarget).attr("id"),this.setActive(),Data.getInst().setConfigIndex(this.index)}remove(t){t.stopPropagation(),this.removeIndex=$(t.currentTarget).parents("li").attr("id");let e=$(t.currentTarget).siblings("span").html();Modal.getInst().removeConfiguration(this.removeConfirm.bind(this),e)}removeConfirm(){Data.getInst().removeConfig(this.removeIndex),this.configs.find(`li[id=${this.removeIndex}]`).remove()}updateDOMName(t){let e=this.getName(t,this.index);this.configs.find(`span[id=${this.index}]`).html(e)}}
class Subscription{constructor(){this.msg='<h6 class="font-weight-light">Subscribe to access all PRO features with 15 Days free Trial<br/>\n    <br/>&#10003; <a href="https://github.com/Dhruv-Techapps/auto-click/wiki/Init-Wait" target="_blank">Init Wait</a>\n    <br/>&#10003; <a href="https://github.com/Dhruv-Techapps/auto-click/wiki/Repeat" target="_blank">Repeat</a>\n    <br/>&#10003; <a href="https://github.com/Dhruv-Techapps/auto-click/wiki/Repeat-Interval" target="_blank">R-Interval</a>\n    <br/>&#10003; <a href="https://github.com/Dhruv-Techapps/auto-click/wiki/Start-Time" target="_blank">Start Time</a>\n    <br/><br/><small class="text-danger font-weight-normal">* You can unsubscribe back anytime from <a href="https://payments.google.com/" target="_blank">Google Payment Center</a></small></h6>'}subscribeModal(){return new Promise((t,e)=>{this.resolve=t,this.reject=e,Modal.getInst().subscribe(this.subscribe.bind(this),e,this.msg)})}subscribe(){google.payments.inapp.buy({parameters:{env:"prod"},sku:"pro.sub.mon",success:this.resolve,failure:this.reject})}}