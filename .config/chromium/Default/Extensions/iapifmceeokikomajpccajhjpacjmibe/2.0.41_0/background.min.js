chrome&&(browser=chrome),localStorage.setItem("manifest",JSON.stringify(browser.runtime.getManifest()));var _browserInfo=navigator.userAgent.match(/(firefox|msie|chrome|safari)/gi);browser.runtime.onInstalled.addListener(onInstalled),browser.runtime.onStartup.addListener(onStartup),browser.runtime.onUpdateAvailable.addListener(onUpdateAvailable),browser.runtime.onMessage.addListener(onMessage),browser.runtime.setUninstallURL(browser.runtime.getManifest().UninstallURL),browser.browserAction.onClicked.addListener(function(){new Tabs("options_page/index.html")}),browser.notifications.onClicked.addListener(notificationsOnClicked),_purchases=[],document.addEventListener("DOMContentLoaded",()=>{createContextMenu(),google.payments.inapp.getPurchases({parameters:{env:"prod"},success:e=>{for(let t in e.response.details){let o=e.response.details[t];"ACTIVE"===o.state&&_purchases.push(o)}}}),browser.identity.getProfileUserInfo(e=>{_user=e})},!1);class Configs{escape(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}constructor(e,t){try{let t=Storage.getItem("configs")||Storage.getItem("examples");for(let o in t){let s=t[o];if(s&&"object"==typeof s&&!Array.isArray(s)&&s.enable&&s.url&&new RegExp(s.url).test(e))return browser.browserAction.setIcon({path:"assets/icons/icon_64.png"}),this.checkLicense(s)}}catch(e){Logger.error(e)}return t||browser.browserAction.setIcon({path:"assets/icons/icon_64-black.png"}),console.log(`No Records Found ${e}`),null}checkLicense(e){if(_purchases&&0==_purchases.length){let o;localStorage.getItem("licenseDate")?o=new Date(localStorage.getItem("licenseDate")):(o=new Date,localStorage.setItem("licenseDate",o.toJSON()));let s=new Date;var t=Math.abs(o.getTime()-s.getTime());if(Math.ceil(t/864e5)>=16){let t={expired:!0};browser.browserAction.setIcon({path:"assets/icons/icon_64-black.png"}),chrome.browserAction.setTitle({title:"Your Auto Click PRO License is expired"});let o=Storage.getItem("test");return""!=_user.email&&-1!==o.indexOf(_user.email)?e:t}return e}return e}}function createContextMenu(){browser.contextMenus.create({id:"xpath-selection",title:Storage.getItem("manifest").name,contexts:["all"]})}browser.contextMenus.onClicked.addListener(function(e,t){switch(e.menuItemId){case"xpath-selection":new Tabs(`options_page/index.html?xpath=${encodeURIComponent(localStorage.xpath)}&url=${encodeURIComponent(localStorage.URL)}`),localStorage.removeItem("xpath")}});var _gaq=_gaq||[];_gaq.push(["_setAccount",browser.runtime.getManifest().trackingID]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();class Notification{constructor(e){this.manifest=Storage.getItem("manifest"),this.notifications=[]}static getInst(){return this.inst||(this.inst=new Notification)}create(e){e.notificationId=(new Date).toJSON(),this.notifications[e.notificationId]=e;let t=this.getNotificationObj(e);Storage.getItem("settings")&&Storage.getItem("settings").notifications&&browser.notifications.create(e.notificationId,t)}getInfo(e){return this.notifications[e]}getNotificationObj(e){let t={type:e.type||"basic",iconUrl:e.icon||this.manifest.browser_action.default_icon,title:e.title||this.manifest.name,message:e.message,items:e.items};return e.requireInteraction&&(t.isClickable=e.requireInteraction,t.requireInteraction=e.requireInteraction),t}}function notificationsOnClicked(e){new Tabs(Notification.getInst().getInfo(e).url),browser.notifications.clear(e)}function onInstalled(){try{Rest.getInst().init().then(e=>{localStorage.getItem("configs")||(localStorage.setItem("configs",localStorage.getItem("examples")),new Tabs("options_page/index.html"))}).catch(e=>Logger.error(e)),checkLicenseDate()}catch(e){Logger.error(e)}}function checkLicenseDate(){chrome.storage.sync.get(["licenseDate"],function(e){if(e.licenseDate)localStorage.setItem("licenseDate",e.licenseDate);else{let e=new Date;localStorage.setItem("licenseDate",e.toJSON()),chrome.storage.sync.set({licenseDate:e.toJSON()})}})}function onMessage(e,t,o){try{switch(e.action){case"setxPathAndURL":localStorage.URL=e.URL,localStorage.xpath=e.xpath;break;case"settings":o({response:Storage.getItem(e.action)||{}});break;case"configs":o({response:new Configs(e.URL,e.frameElement)||{}});break;case"localStorage":"GET"===e.type?o({response:Storage.getItem(e.key)||("configs"===e.key?Storage.getItem("examples"):{})}):localStorage[e.key]=e.value;break;case"notify":Notification.getInst().create(e);break;case"ga":e.event.push(...[`${_purchases.length}`,`${_user.email} ${_browserInfo[0]}`]),e.event.unshift("_trackEvent"),checkForLicense(e.event),_gaq.push(e.event),Rate.getInst().check();break;case"amazon":e.event.unshift("_trackEvent"),_gaq.push(e.event);break;default:throw new Error(`${e.action} is not configured`)}}catch(e){Logger.error(e)}}function checkForLicense(e){if(-1!==e[1].indexOf("true")&&0==_purchases.length){let s;localStorage.getItem("licenseDate")?s=new Date(localStorage.getItem("licenseDate")):(s=new Date,localStorage.setItem("licenseDate",s.toJSON()));let a=new Date;var t=Math.abs(s.getTime()-a.getTime()),o=Math.ceil(t/864e5);chrome.browserAction.setBadgeText({text:" "+(16-o)}),chrome.browserAction.setTitle({title:`Your Auto Click PRO License is expired and will stop all pro feature in ${16-o} days`}),o>=16&&(e[2]+=`:${16-o} days left`,localStorage.setItem("mode","LITE"),chrome.browserAction.setTitle({title:"Your Auto Click PRO License is expired"}))}}function onStartup(){try{Rest.getInst().versions().then(e=>{if(e=JSON.parse(e),!localStorage.versionNo||localStorage.versionNo<e.versionNo){localStorage.versionNo=e.versionNo;for(let t in e.updates)localStorage.removeItem(e.updates[t].name),Rest.getInst()[e.updates[t].name]()}}).catch(e=>Logger.error(e)),localStorage.removeItem("test"),Rest.getInst().test()}catch(e){Logger.error(e)}}function onUpdateAvailable(e){Logger.log("updating to version "+e.version),browser.runtime.reload()}class Rate{constructor(){this.currentDate=new Date,this.currentDate.setHours(0,0,0,0),localStorage.getItem("rate")?this.storage=JSON.parse(localStorage.getItem("rate")):this.storage={count:3,date:this.currentDate.toJSON(),show:!0}}static getInst(){return this.inst||(this.inst=new Rate)}check(){this.storage.show&&(3==this.storage.count||new Date(this.storage.date)<this.currentDate)&&this.show()}rated(e){this.storage.show=!1,this.save(e)}later(e){this.storage.count--,this.storage.date=this.currentDate.toJSON(),this.save(e)}save(e){localStorage.setItem("rate",JSON.stringify(this.storage)),browser.notifications.clear(e)}show(){let e={type:"basic",iconUrl:browser.runtime.getManifest().browser_action.default_icon,title:"Enjoying the extension?",message:"Please help us become a 5-star extension,\nThank you!",requireInteraction:!0,buttons:[{title:"❤ Rate Now"},{title:"☹ Later"}]};browser.notifications.create((new Date).toJSON(),e)}}browser.notifications.onButtonClicked.addListener((e,t)=>{0==t?(new Tabs("https://chrome.google.com/webstore/detail/auto-click-auto-fill/iapifmceeokikomajpccajhjpacjmibe/reviews"),Rate.getInst().rated(e)):Rate.getInst().later(e)});class Tabs{constructor(e){this.url=e,this.create()}create(){browser.tabs.create({url:this.url})}}